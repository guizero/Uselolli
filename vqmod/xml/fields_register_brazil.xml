<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>Campos para cadastro do Brasil (Sexo, Data de Nascimento, CPF, RG, CNPJ, Razão Social, Inscrição Estadual, Apelido p/ Endereço, Número e Complemento)</id>
	<version>1.2</version>
	<vqmver>2.2.1</vqmver>
	<author>Deives Fahl - dfahl.cps@gmail.com</author>
	<!-- Inicio: System/Library/Customer -->
	<file name="system/library/customer.php">
		<operation>
			<search position="after" index="1"><![CDATA[private $address_id;]]></search>
			<add><![CDATA[
				private $data_nascimento;
				private $sexo;
				private $cpf;
				private $rg;
				private $cnpj;
				private $razao_social;
				private $inscricao_estadual;
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1,2"><![CDATA[$this->address_id = $customer_query->row['address_id'];]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$this->data_nascimento    = $customer_query->row['data_nascimento'];
					$this->sexo               = $customer_query->row['sexo'];
					$this->cpf                = $customer_query->row['cpf'];
					$this->rg                 = $customer_query->row['rg'];
					$this->cnpj               = $customer_query->row['cnpj'];
					$this->razao_social       = $customer_query->row['razao_social'];
					$this->inscricao_estadual = $customer_query->row['inscricao_estadual'];
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[$this->address_id = '';]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$this->data_nascimento    = '';
					$this->sexo               = '';
					$this->cpf                = '';
					$this->rg                 = '';
					$this->cnpj               = '';
					$this->razao_social       = '';
					$this->inscricao_estadual = '';
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[public function getBalance() {]]></search>
			<add><![CDATA[
				public function getDataNascimento() {
					return $this->data_nascimento;
				}

				public function getSexo() {
					return $this->sexo;
				}

				public function getCpf() {
					return $this->cpf;
				}

				public function getRg() {
					return $this->rg;
				}

				public function getCnpj() {
					return $this->cnpj;
				}

				public function getRazaoSocial() {
					return $this->razao_social;
				}

				public function getInscricaoEstadual() {
					return $this->inscricao_estadual;
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: System/Library/Customer -->

	<!-- Inicio: Admin/Model/Sale/Order -->
	<file name="admin/model/sale/order.php">
		<operation>
			<search position="after" index="1"><![CDATA['fax'                     => $order_query->row['fax'],]]></search>
			<add><![CDATA[
				'sexo'                     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['sexo'] : '',
				'data_nascimento'          => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['data_nascimento'] : '',
				'cpf'                      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['cpf'] : '',
				'rg'                       => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['rg'] : '',
				'cnpj'                     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['cnpj'] : '',
				'razao_social'             => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['razao_social'] : '',
				'inscricao_estadual'       => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['inscricao_estadual'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['shipping_firstname'      => $order_query->row['shipping_firstname'],]]></search>
			<add><![CDATA[
				'shipping_apelido'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_apelido'] : '',
				'shipping_numero'       => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_numero'] : '',
				'shipping_complemento'  => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['payment_firstname'       => $order_query->row['payment_firstname'],]]></search>
			<add><![CDATA[
				'payment_apelido'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_apelido'] : '',
				'payment_numero'       => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_numero'] : '',
				'payment_complemento'  => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($invoice_prefix) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($store_name) . "',store_url = '" . $this->db->escape($store_url) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', language_id = '" . (int)$this->config->get('config_language_id') . "', currency_id = '" . (int)$currency_id . "', currency_code = '" . $this->db->escape($currency_code) . "', currency_value = '" . (float)$currency_value . "', date_added = NOW(), date_modified = NOW()");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$dataparts = explode('/', $data['data_nascimento']);
					if (sizeof($dataparts) == '3'){
						$data['data_nascimento'] = $dataparts[2]."-".$dataparts[1]."-".$dataparts[0];
					}else{
						$data['data_nascimento'] = '0000-00-00';
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($invoice_prefix) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($store_name) . "',store_url = '" . $this->db->escape($store_url) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', cpf = '" . $this->db->escape($data['cpf']) . "', cnpj = '" . $this->db->escape($data['cnpj']) . "', rg = '" . $this->db->escape($data['rg']) . "', razao_social = '" . $this->db->escape($data['razao_social']) . "', inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "', data_nascimento = '" . $this->db->escape($data['data_nascimento']) . "', sexo = '" . $this->db->escape($data['sexo']) . "', payment_apelido = '" . $this->db->escape($data['payment_apelido']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_numero = '" . $this->db->escape($data['payment_numero']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_complemento = '" . $this->db->escape($data['payment_complemento']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_apelido = '" . $this->db->escape($data['shipping_apelido']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_numero = '" . $this->db->escape($data['shipping_numero']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_complemento = '" . $this->db->escape($data['shipping_complemento']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', language_id = '" . (int)$this->config->get('config_language_id') . "', currency_id = '" . (int)$currency_id . "', currency_code = '" . $this->db->escape($currency_code) . "', currency_value = '" . (float)$currency_value . "', date_added = NOW(), date_modified = NOW()");
				}else{
					$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($invoice_prefix) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($store_name) . "',store_url = '" . $this->db->escape($store_url) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', language_id = '" . (int)$this->config->get('config_language_id') . "', currency_id = '" . (int)$currency_id . "', currency_code = '" . $this->db->escape($currency_code) . "', currency_value = '" . (float)$currency_value . "', date_added = NOW(), date_modified = NOW()");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("UPDATE `" . DB_PREFIX . "order` SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "',  shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', date_modified = NOW() WHERE order_id = '" . (int)$order_id . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$dataparts = explode('/', $data['data_nascimento']);
					if (sizeof($dataparts) == '3'){
						$data['data_nascimento'] = $dataparts[2]."-".$dataparts[1]."-".$dataparts[0];
					}else{
						$data['data_nascimento'] = '0000-00-00';
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("UPDATE `" . DB_PREFIX . "order` SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', cpf = '" . $this->db->escape($data['cpf']) . "', cnpj = '" . $this->db->escape($data['cnpj']) . "', rg = '" . $this->db->escape($data['rg']) . "', razao_social = '" . $this->db->escape($data['razao_social']) . "', inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "', data_nascimento = '" . $this->db->escape($data['data_nascimento']) . "', sexo = '" . $this->db->escape($data['sexo']) . "', payment_apelido = '" . $this->db->escape($data['payment_apelido']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_numero = '" . $this->db->escape($data['payment_numero']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_complemento = '" . $this->db->escape($data['payment_complemento']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_apelido = '" . $this->db->escape($data['shipping_apelido']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "',  shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_numero = '" . $this->db->escape($data['shipping_numero']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_complemento = '" . $this->db->escape($data['shipping_complemento']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', date_modified = NOW() WHERE order_id = '" . (int)$order_id . "'");
				}else{
					$this->db->query("UPDATE `" . DB_PREFIX . "order` SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($payment_country) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($payment_zone) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($payment_address_format) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "',  shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($shipping_country) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($shipping_zone) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($shipping_address_format) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', order_status_id = '" . (int)$data['order_status_id'] . "', affiliate_id  = '" . (int)$data['affiliate_id'] . "', date_modified = NOW() WHERE order_id = '" . (int)$order_id . "'");
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/Model/Sale/Order -->

	<!-- Inicio: Admin/Controller/Sale/Order -->
	<file name="admin/controller/sale/order.php">
		<operation>
			<search position="before" index="1"><![CDATA[public function insert() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[if ($order_info['customer_id']) {]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$this->data['sexo']               = $order_info['sexo'];
					$this->data['data_nascimento']    = $order_info['data_nascimento'];
					$this->data['cpf']                = $order_info['cpf'];
					$this->data['rg']                 = $order_info['rg'];
					$this->data['cnpj']               = $order_info['cnpj'];
					$this->data['razao_social']       = $order_info['razao_social'];
					$this->data['inscricao_estadual'] = $order_info['inscricao_estadual'];
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[$this->data['date_modified'] = date($this->language->get('date_format_short'), strtotime($order_info['date_modified']));]]></search>
			<add><![CDATA[
				$this->data['payment_apelido']     = ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_apelido'] : '';
				$this->data['payment_numero']      = ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_numero'] : '';
				$this->data['payment_complemento'] = ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_complemento'] : '';
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[$this->data['payment_country'] = $order_info['payment_country'];]]></search>
			<add><![CDATA[
				$this->data['shipping_apelido']     = ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_apelido'] : '';
				$this->data['shipping_numero']      = ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_numero'] : '';
				$this->data['shipping_complemento'] = ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_complemento'] : '';
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['error_telephone'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->error['data_nascimento'])) {
						$this->data['error_data_nascimento'] = $this->error['data_nascimento'];
					} else {
						$this->data['error_data_nascimento'] = '';
					}

					if (isset($this->error['cpf'])) {
						$this->data['error_cpf'] = $this->error['cpf'];
					} else {
						$this->data['error_cpf'] = '';
					}

					if (isset($this->error['cnpj'])) {
						$this->data['error_cnpj'] = $this->error['cnpj'];
					} else {
						$this->data['error_cnpj'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['error_shipping_address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->error['shipping_numero'])) {
						$this->data['error_shipping_numero'] = $this->error['shipping_numero'];
					} else {
						$this->data['error_shipping_numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['error_payment_address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->error['payment_numero'])) {
						$this->data['error_payment_numero'] = $this->error['payment_numero'];
					} else {
						$this->data['error_payment_numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['fax'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['pessoa'])) {
						$this->data['pessoa'] = $this->request->post['pessoa'];
					} else {
						$this->data['pessoa'] = '';
					}

					if (isset($this->request->post['sexo'])) {
						$this->data['sexo'] = $this->request->post['sexo'];
					} elseif (!empty($order_info)) { 
						$this->data['sexo'] = $order_info['sexo'];
					} else {
						$this->data['sexo'] = '';
					}

					if (isset($this->request->post['data_nascimento'])) {
						$this->data['data_nascimento'] = $this->request->post['data_nascimento'];
					} elseif (!empty($order_info)) { 
						$this->data['data_nascimento'] = $order_info['data_nascimento'];
					} else {
						$this->data['data_nascimento'] = '';
					}

					if (isset($this->request->post['cpf'])) {
						$this->data['cpf'] = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
					} elseif (!empty($order_info)) { 
						$this->data['cpf'] = $order_info['cpf'];
					} else {
						$this->data['cpf'] = '';
					}

					if (isset($this->request->post['rg'])) {
						$this->data['rg'] = preg_replace('/([^0-9])/i','',$this->request->post['rg']);
					} elseif (!empty($order_info)) { 
						$this->data['rg'] = $order_info['rg'];
					} else {
						$this->data['rg'] = '';
					}

					if (isset($this->request->post['cnpj'])) {
						$this->data['cnpj'] = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
					} elseif (!empty($order_info)) { 
						$this->data['cnpj'] = $order_info['cnpj'];
					} else {
						$this->data['cnpj'] = '';
					}

					if (isset($this->request->post['razao_social'])) {
						$this->data['razao_social'] = $this->request->post['razao_social'];
					} elseif (!empty($order_info)) { 
						$this->data['razao_social'] = $order_info['razao_social'];
					} else {
						$this->data['razao_social'] = '';
					}

					if (isset($this->request->post['inscricao_estadual'])) {
						$this->data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->request->post['inscricao_estadual']);
					} elseif (!empty($order_info)) { 
						$this->data['inscricao_estadual'] = $order_info['inscricao_estadual'];
					} else {
						$this->data['inscricao_estadual'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['shipping_zone_id'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['shipping_apelido'])) {
						$this->data['shipping_apelido'] = $this->request->post['shipping_apelido'];
					} elseif (!empty($order_info)) { 
						$this->data['shipping_apelido'] = $order_info['shipping_apelido'];
					} else {
						$this->data['shipping_apelido'] = '';
					}

					if (isset($this->request->post['shipping_numero'])) {
						$this->data['shipping_numero'] = preg_replace('/([^0-9])/i','',$this->request->post['shipping_numero']);
					} elseif (!empty($order_info)) {
						$this->data['shipping_numero'] = $order_info['shipping_numero'];
					} else {
						$this->data['shipping_numero'] = '';
					}

					if (isset($this->request->post['shipping_complemento'])) {
						$this->data['shipping_complemento'] = $this->request->post['shipping_complemento'];
					} elseif (!empty($order_info)) { 
						$this->data['shipping_complemento'] = $order_info['shipping_complemento'];
					} else {
						$this->data['shipping_complemento'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['payment_zone_id'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['payment_apelido'])) {
						$this->data['payment_apelido'] = $this->request->post['payment_apelido'];
					} elseif (!empty($order_info)) { 
						$this->data['payment_apelido'] = $order_info['payment_apelido'];
					} else {
						$this->data['payment_apelido'] = '';
					}

					if (isset($this->request->post['payment_numero'])) {
						$this->data['payment_numero'] = preg_replace('/([^0-9])/i','',$this->request->post['payment_numero']);
					} elseif (!empty($order_info)) { 
						$this->data['payment_numero'] = $order_info['payment_numero'];
					} else {
						$this->data['payment_numero'] = '';
					}

					if (isset($this->request->post['payment_complemento'])) {
						$this->data['payment_complemento'] = $this->request->post['payment_complemento'];
					} elseif (!empty($order_info)) { 
						$this->data['payment_complemento'] = $order_info['payment_complemento'];
					} else {
						$this->data['payment_complemento'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['telephone'] = $this->language->get('error_telephone');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						}
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$this->error['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";  
							}elseif(!$this->isCpf($cpf)){
								$this->error['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$this->error['cnpj'] = "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['payment_address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['payment_numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$this->error['payment_numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['shipping_address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['shipping_numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$this->error['shipping_numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1,2"><![CDATA[$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$format = '{company}' . "\n" . '{cnpj}' . "\n" . '{firstname} {lastname}' . "\n" . '{cpf}' . "\n" . '{address_1}, {numero}, {complemento}' . "\n" . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}else{
					$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1,2"><![CDATA['{firstname}',]]></search>
			<add><![CDATA[
				'{cnpj}',
				'{cpf}',
				'{numero}',
				'{complemento}',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['shipping_firstname'],]]></search>
			<add><![CDATA[
				'cnpj'        => '',
				'cpf'         => '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['payment_firstname'],]]></search>
			<add><![CDATA[
				'cnpj'        => ($this->config->get('fields_register_brazil_status')) ? $order_info['cnpj'] : '',
				'cpf'         => ($this->config->get('fields_register_brazil_status')) ? $order_info['cpf'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$total_data = $this->model_sale_order->getOrderTotals($order_id);]]></search>
			<add><![CDATA[
				$telephone_mask  = '(' . substr($order_info['telephone'], 0, 2) . ') ';
				$telephone_mask .= strlen($order_info['telephone']) == 10 ? substr($order_info['telephone'], 2, 4) . '-' : substr($order_info['telephone'], 2, 5) . '-';
				$telephone_mask .= strlen($order_info['telephone']) == 10 ? substr($order_info['telephone'], 6, 8) : substr($order_info['telephone'], 7, 9);
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA['telephone'          => $order_info['telephone'],]]></search>
			<add><![CDATA[
				'telephone'          => $telephone_mask,
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/Controller/Sale/Order -->

	<!-- Inicio: Admin/View/Template/Sale/Order_Info -->
	<file name="admin/view/template/sale/order_info.tpl">
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><?php echo $telephone; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
					<?php if ($cpf != ''){?>
					<tr>
					  <td>CPF:</td>
					  <td><?php echo $cpf; ?></td>
					</tr>
					<?php if($rg != ''){ ?>
					<tr>
					  <td>RG:</td>
					  <td><?php echo $rg; ?></td>
					</tr>
					<?php } ?>
					<?php }else if ($cnpj != '') {?>
					<tr>
					  <td>CNPJ:</td>
					  <td><?php echo $cnpj; ?></td>
					</tr>
					<?php if($razao_social != ''){ ?>
					<tr>
					  <td>Razao Social:</td>
					  <td><?php echo $razao_social; ?></td>
					</tr>
					<?php } ?>
					<?php if($inscricao_estadual != ''){ ?>
					<tr>
					  <td>Inscrição Estadual:</td>
					  <td><?php echo $inscricao_estadual; ?></td>
					</tr>
					<?php } ?>
					<?php } ?>
					<?php if ($sexo != '') {?>
					<tr>
					  <td>Sexo</td>
					  <?php
					  if ($sexo == 'm'){
						$sexo = 'Masculino';
					  }else{
						$sexo = 'Feminino';
					  }
					  ?>
					  <td><?php echo $sexo; ?></td>
					</tr>
					<?php } ?>
					<?php if ($data_nascimento != '') {?>
					<tr>
					  <td>Data de Nascimento:</td>
					  <?php 
					  $dataparts = explode("-",$data_nascimento);
					  if (sizeof($dataparts) != '3'){
						$data = $data_nascimento;
					  }else{
						$data = $dataparts[2]."/".$dataparts[1]."/".$dataparts[0]; 
					  }
					  $data = ($data != '00/00/0000') ? $data : '';
					  ?>
					  <td><?php echo $data; ?></td>
					</tr>
					<?php }?>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><?php echo $payment_firstname; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php if($payment_apelido != ''){ ?>
				<tr>
				  <td>Local</td>
				  <td><?php echo $payment_apelido; ?></td>
				</tr>
				<?php } ?>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><?php echo $payment_address_1; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php if($payment_numero != ''){ ?>
				<tr>
				  <td>Número</td>
				  <td><?php echo $payment_numero; ?></td>
				</tr>
				<?php } ?>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><?php echo $payment_address_2; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php if($payment_complemento != ''){ ?>
				<tr>
				  <td>Complemento</td>
				  <td><?php echo $payment_complemento; ?></td>
				</tr>
				<?php } ?>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><?php echo $shipping_firstname; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local</td>
				  <td><?php echo $shipping_apelido; ?></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><?php echo $shipping_address_1; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Número</td>
				  <td><?php echo $shipping_numero; ?></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><?php echo $shipping_address_2; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento</td>
				  <td><?php echo $shipping_complemento; ?></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/View/Template/Sale/Order_Info -->

	<!-- Inicio: Admin/View/Template/Sale/Order_Form -->
	<file name="admin/view/template/sale/order_form.tpl">
		<operation>
			<search position="after" index="1"><![CDATA[<?php echo $header; ?>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript">
				 $(document).ready(function() {
					/* Registro - Tipo de Pessoa (PF/PJ) */
					if ($("#fisica").is(':checked')) {
						$('.pessoa_fisica').show();
						$('.pessoa_juridica').hide();    
					}
					if ($("#juridica").is(':checked')) {
						$('.pessoa_fisica').hide();
						$('.pessoa_juridica').show(); 
					}
					$('#juridica').click( function() {
					$('.pessoa_fisica').hide();
						$("#cpf").val("");
						$("#rg").val("");
						$('.pessoa_juridica').show();    
					});
					$('#fisica').click( function() {
					$('.pessoa_fisica').show();
						$("#cnpj").val("");
						$("#razao_social").val("");
						$("#inscricao_estadual").val("");
						$('.pessoa_juridica').hide();
					}); 
				});    
				</script>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[fax: item['fax'],]]></search>
			<add><![CDATA[
				sexo: item['sexo'],
				data_nascimento: item['data_nascimento'],
				cpf: item['cpf'],
				rg: item['rg'],
				cnpj: item['cnpj'],
				razao_social: item['razao_social'],
				inscricao_estadual: item['inscricao_estadual'],
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[$('input[name=\'fax\']').attr('value', ui.item['fax']);]]></search>
			<add><![CDATA[
				$('input[name=\'sexo\']').attr('checked', false);
				$('input[id="sexo_'+ ui.item['sexo'] +'"]').attr('checked', true);

				var dataparts = ui.item['data_nascimento'].split('-');
				$('input[name=\'data_nascimento\']').attr('value', dataparts[2] + '/' + dataparts[1] + '/' + dataparts[0]);

				if(ui.item['cpf'] != ''){
					$('input#fisica').trigger('click');
				}else if(ui.item['cnpj'] != ''){
					$('input#juridica').trigger('click');
				}else{
					$('input#fisica').trigger('click');
				}

				$('input[name=\'cpf\']').attr('value', ui.item['cpf']);
				$('input[name=\'rg\']').attr('value', ui.item['rg']);
				$('input[name=\'cnpj\']').attr('value', ui.item['cnpj']);
				$('input[name=\'razao_social\']').attr('value', ui.item['razao_social']);
				$('input[name=\'inscricao_estadual\']').attr('value', ui.item['inscricao_estadual']);
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1,2"><![CDATA[<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname'] . ' ' . $address['lastname'] . ', ' . $address['address_1'] . ', ' . $address['city'] . ', ' . $address['country']; ?></option>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php
				$address_apelido_info     = ($address['apelido'] != '') ? '('. $address['apelido'] .') ' : '';
				$address_complemento_info = ($address['complemento'] != '') ? ', ' . $address['complemento'] : '';
				?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $address_apelido_info . $address['firstname'] . ' ' . $address['lastname'] . ', ' . $address['address_1'] . ', ' . $address['numero'] . $address_complemento_info . ', ' . $address['city'] . ', ' . $address['country']; ?></option>
				<?php }else{ ?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname'] . ' ' . $address['lastname'] . ', ' . $address['address_1'] . ', ' . $address['city'] . ', ' . $address['country']; ?></option>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[html += '<option value="' + ui.item['address'][i]['address_id'] + '">' + ui.item['address'][i]['firstname'] + ' ' + ui.item['address'][i]['lastname'] + ', ' + ui.item['address'][i]['address_1'] + ', ' + ui.item['address'][i]['city'] + ', ' + ui.item['address'][i]['country'] + '</option>';]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				var address_apelido_info     = (ui.item['address'][i]['apelido'] != '') ? '('+ ui.item['address'][i]['apelido'] +') ' : '';
				var address_complemento_info = (ui.item['address'][i]['complemento'] != '') ? ', ' + ui.item['address'][i]['complemento'] : '';
				html += '<option value="' + ui.item['address'][i]['address_id'] + '">' + address_apelido_info + ui.item['address'][i]['firstname'] + ' ' + ui.item['address'][i]['lastname'] + ', ' + ui.item['address'][i]['address_1'] + ', ' + ui.item['address'][i]['numero'] + address_complemento_info + ', ' + ui.item['address'][i]['city'] + ', ' + ui.item['address'][i]['country'] + '</option>';
				<?php }else{ ?>
				html += '<option value="' + ui.item['address'][i]['address_id'] + '">' + ui.item['address'][i]['firstname'] + ' ' + ui.item['address'][i]['lastname'] + ', ' + ui.item['address'][i]['address_1'] + ', ' + ui.item['address'][i]['city'] + ', ' + ui.item['address'][i]['country'] + '</option>';
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[$('input[name=\'payment_firstname\']').attr('value', json['firstname']);]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				$('input[name=\'payment_apelido\']').attr('value', json['apelido']);
				$('input[name=\'payment_numero\']').attr('value', json['numero']);
				$('input[name=\'payment_complemento\']').attr('value', json['complemento']);
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[$('input[name=\'shipping_firstname\']').attr('value', json['firstname']);]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				$('input[name=\'shipping_apelido\']').attr('value', json['apelido']);
				$('input[name=\'shipping_numero\']').attr('value', json['numero']);
				$('input[name=\'shipping_complemento\']').attr('value', json['complemento']);
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="fax" value="<?php echo $fax; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Sexo:</td>
				  <td>
				    <?php if($sexo == 'm'){ ?>
					<input type="radio" name="sexo" id="sexo_m" checked value="m" />Masculino
					<input type="radio" name="sexo" id="sexo_f" value="f" />Feminino
					<?php }elseif($sexo == 'f'){ ?>
					<input type="radio" name="sexo" id="sexo_m" value="m" />Masculino
					<input type="radio" name="sexo" id="sexo_f" checked value="f" />Feminino
					<?php }else{ ?>
					<input type="radio" name="sexo" id="sexo_m" checked value="m" />Masculino
					<input type="radio" name="sexo" id="sexo_f" value="f" />Feminino
					<?php } ?>
				  </td>
				</tr>
				<tr>
				  <td>Data de Nascimento:</td>
				  <td>
				    <?php
					$dataparts = explode('-', $data_nascimento);
					if (sizeof($dataparts) == '3'){
						$data_nascimento = $dataparts[2]."/".$dataparts[1]."/".$dataparts[0];
					}
					$data_nascimento = ($data_nascimento != '00/00/0000') ? $data_nascimento : '';
					?>
				    <input type="text" name="data_nascimento" value="<?php echo $data_nascimento; ?>" />
					<?php if ($error_data_nascimento) { ?>
					<span class="error"><?php echo $error_data_nascimento; ?></span>
					<?php } ?>
				  </td>
				</tr>
				<tr>
				  <td>Tipo:</td>
				  <td>
				    <?php if($pessoa == 'fisica'){ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php }else if($pessoa == 'juridica'){ ?>
					<input type="radio" name="pessoa" id="fisica" value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" checked value="juridica">Pessoa Juridica
					<?php }else{ ?>
					<?php if($cpf != ''){ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php }elseif($cnpj != ''){ ?>
					<input type="radio" name="pessoa" id="fisica" value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" checked value="juridica">Pessoa Juridica
					<?php }else{ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php } ?>
					<?php } ?>
			      </td>
				</tr>
				<tr class="pessoa_fisica">
				  <td><span class="required">*</span> CPF:</td>
				  <td>
					<input type="text" name="cpf"  id="cpf" value="<?php echo $cpf; ?>" > 
					<?php if ($error_cpf) { ?>
					<span class="error"><?php echo $error_cpf; ?></span>
					<?php } ?>
				  </td>
				</tr>
				<tr class="pessoa_fisica">
				  <td>RG:</td>
				  <td><input type="text" name="rg" id="rg" value="<?php echo $rg; ?>" ></td>
				</tr>
				<tr class="pessoa_juridica">
				  <td><span class="required">*</span> CNPJ:</td>
				  <td>
					<input type="text" name="cnpj" id="cnpj" value="<?php echo $cnpj; ?>">
					<?php if ($error_cnpj) { ?>
					<span class="error"><?php echo $error_cnpj; ?></span>
					<?php } ?>
				  </td>
				</tr>
				<tr class="pessoa_juridica">
				  <td>Razão Social:</td>
				  <td><input type="text" name="razao_social" id="razao_social" value="<?php echo $razao_social; ?>"></td>
				</tr>
				<tr class="pessoa_juridica">
				  <td>Inscrição Estadual:</td>
				  <td><input type="text" name="inscricao_estadual" id="inscricao_estadual" value="<?php echo $inscricao_estadual; ?>"></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="payment_firstname" value="<?php echo $payment_firstname; ?>" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="payment_apelido" value="<?php echo $payment_apelido; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="payment_address_1" value="<?php echo $payment_address_1; ?>" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td>
				    <input type="text" name="payment_numero" value="<?php echo $payment_numero; ?>" />
				    <?php if ($error_payment_numero) { ?>
				    <span class="error"><?php echo $error_payment_numero; ?></span>
				    <?php } ?>
				  </td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="payment_address_2" value="<?php echo $payment_address_2; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="payment_complemento" value="<?php echo $payment_complemento; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="shipping_firstname" value="<?php echo $shipping_firstname; ?>" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="shipping_apelido" value="<?php echo $shipping_apelido; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="shipping_address_1" value="<?php echo $shipping_address_1; ?>" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td>
				    <input type="text" name="shipping_numero" value="<?php echo $shipping_numero; ?>" />
				    <?php if ($error_shipping_numero) { ?>
				    <span class="error"><?php echo $error_shipping_numero; ?></span>
				    <?php } ?>
				  </td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="shipping_address_2" value="<?php echo $shipping_address_2; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="shipping_complemento" value="<?php echo $shipping_complemento; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$('input[name=\'payment_address_1\']').after('<span class="error">' + json['error']['payment']['address_1'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['payment']['numero']) {
					$('input[name=\'payment_numero\']').after('<span class="error">' + json['error']['payment']['numero'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$('input[name=\'shipping_address_1\']').after('<span class="error">' + json['error']['shipping']['address_1'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['numero']['address_1']) {
					$('input[name=\'shipping_numero\']').after('<span class="error">' + json['error']['shipping']['numero'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/View/Template/Sale/Order_Form -->

	<!-- Inicio: Admin/Model/Sale/Customer -->
	<file name="admin/model/sale/customer.php">
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', status = '" . (int)$data['status'] . "', date_added = NOW()");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if ($data['data_nascimento'] == ""){
						$dataparts[0] = "00";
						$dataparts[1] = "00";
						$dataparts[2] = "0000";
					}else{
						$dataparts = explode("/",$data['data_nascimento']);
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', status = '" . (int)$data['status'] . "', date_added = NOW()" . "',cpf = '" . $this->db->escape($data['cpf']) . "',rg = '" . $this->db->escape($data['rg']) . "',cnpj = '" . $this->db->escape($data['cnpj']) . "',razao_social = '" . $this->db->escape($data['razao_social']) . "',inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "',data_nascimento = '" . $this->db->escape($dataparts[2]."-".$dataparts[1]."-".$dataparts[0]) . "',sexo = '" . $this->db->escape($data['sexo']));
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', status = '" . (int)$data['status'] . "', date_added = NOW()");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', status = '" . (int)$data['status'] . "' WHERE customer_id = '" . (int)$customer_id . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if ($data['data_nascimento'] == ""){
						$dataparts[0] = "00";
						$dataparts[1] = "00";
						$dataparts[2] = "0000";
					}else{
						$dataparts = explode("/",$data['data_nascimento']);
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "',cpf = '" . $this->db->escape($data['cpf']) . "',rg = '" . $this->db->escape($data['rg']) . "',cnpj = '" . $this->db->escape($data['cnpj']) . "',razao_social = '" . $this->db->escape($data['razao_social']) . "',inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "',data_nascimento = '" . $this->db->escape($dataparts[2]."-".$dataparts[1]."-".$dataparts[0]) . "',sexo = '" . $this->db->escape($data['sexo']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', status = '" . (int)$data['status'] . "' WHERE customer_id = '" . (int)$customer_id . "'");
				}else{
					$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', newsletter = '" . (int)$data['newsletter'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', status = '" . (int)$data['status'] . "' WHERE customer_id = '" . (int)$customer_id . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$address['apelido']   = ucwords(strtr(strtolower($address['apelido']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['firstname'] = ucwords(strtr(strtolower($address['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['lastname']  = ucwords(strtr(strtolower($address['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['address_1'] = ucwords(strtr(strtolower($address['address_1']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['address_2'] = ucwords(strtr(strtolower($address['address_2']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['city']      = ucwords(strtr(strtolower($address['city']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['numero']    = preg_replace('/([^0-9])/i','',$address['numero']);
					$address['postcode']  = preg_replace('/([^0-9])/i','',$address['postcode']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', apelido = '" . $this->db->escape($address['apelido']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', numero = '" . $this->db->escape($address['numero']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', complemento = '" . $this->db->escape($address['complemento']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "address SET address_id = '" . (int)$address['address_id'] . "', customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$address['apelido']   = ucwords(strtr(strtolower($address['apelido']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['firstname'] = ucwords(strtr(strtolower($address['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['lastname']  = ucwords(strtr(strtolower($address['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['address_1'] = ucwords(strtr(strtolower($address['address_1']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['address_2'] = ucwords(strtr(strtolower($address['address_2']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['city']      = ucwords(strtr(strtolower($address['city']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$address['numero']    = preg_replace('/([^0-9])/i','',$address['numero']);
					$address['postcode']  = preg_replace('/([^0-9])/i','',$address['postcode']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET address_id = '" . (int)$address['address_id'] . "', customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', apelido = '" . $this->db->escape($address['apelido']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', numero = '" . $this->db->escape($address['numero']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', complemento = '" . $this->db->escape($address['complemento']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET address_id = '" . (int)$address['address_id'] . "', customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($address['firstname']) . "', lastname = '" . $this->db->escape($address['lastname']) . "', company = '" . $this->db->escape($address['company']) . "', company_id = '" . $this->db->escape($address['company_id']) . "', tax_id = '" . $this->db->escape($address['tax_id']) . "', address_1 = '" . $this->db->escape($address['address_1']) . "', address_2 = '" . $this->db->escape($address['address_2']) . "', city = '" . $this->db->escape($address['city']) . "', postcode = '" . $this->db->escape($address['postcode']) . "', country_id = '" . (int)$address['country_id'] . "', zone_id = '" . (int)$address['zone_id'] . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname'      => $address_query->row['firstname'],]]></search>
			<add><![CDATA[
				'apelido'      => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['apelido'] : '',
				'numero'       => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['numero'] : '',
				'complemento'  => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['complemento'] : '',
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/Model/Sale/Customer -->

	<!-- Inicio: Admin/Controller/Sale/Customer -->
	<file name="admin/controller/sale/customer.php">
		<operation>
			<search position="before" index="1"><![CDATA[public function insert() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['fax'               => $result['fax'],]]></search>
			<add><![CDATA[
				'sexo'               => ($this->config->get('fields_register_brazil_status')) ? $result['sexo'] : '',
				'data_nascimento'    => ($this->config->get('fields_register_brazil_status')) ? $result['data_nascimento'] : '',
				'cpf'                => ($this->config->get('fields_register_brazil_status')) ? $result['cpf'] : '',
				'rg'                 => ($this->config->get('fields_register_brazil_status')) ? $result['rg'] : '',
				'cnpj'               => ($this->config->get('fields_register_brazil_status')) ? $result['cnpj'] : '',
				'razao_social'       => ($this->config->get('fields_register_brazil_status')) ? $result['razao_social'] : '',
				'inscricao_estadual' => ($this->config->get('fields_register_brazil_status')) ? $result['inscricao_estadual'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[$this->data['error_lastname'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->error['data_nascimento'])) {
						$this->data['error_data_nascimento'] = $this->error['data_nascimento'];
					} else {
						$this->data['error_data_nascimento'] = '';
					}
	
					if (isset($this->error['cpf'])) {
						$this->data['error_cpf'] = $this->error['cpf'];
					} else {
						$this->data['error_cpf'] = '';
					}
	
					if (isset($this->error['cnpj'])) {
						$this->data['error_cnpj'] = $this->error['cnpj'];
					} else {
						$this->data['error_cnpj'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['telephone'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['pessoa'])) {
						$this->data['pessoa'] = $this->request->post['pessoa'];
					} else {
						$this->data['pessoa'] = '';
					}

					if (isset($this->request->post['sexo'])) {
						$this->data['sexo'] = $this->request->post['sexo'];
					} elseif (isset($customer_info)) {
						$this->data['sexo'] = $customer_info['sexo'];
					} else {
						$this->data['sexo'] = '';
					}
	
					if (isset($this->request->post['data_nascimento'])) {
						$this->data['data_nascimento'] = $this->request->post['data_nascimento'];
					} elseif (isset($customer_info)) {
						$this->data['data_nascimento'] = $customer_info['data_nascimento'];
					} else {
						$this->data['data_nascimento'] = '';
					}
	
					if (isset($this->request->post['cpf'])) {
						$this->data['cpf'] = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
					} elseif (isset($customer_info)) {
						$this->data['cpf'] = $customer_info['cpf'];
					} else {
						$this->data['cpf'] = '';
					}
	
					if (isset($this->request->post['rg'])) {
						$this->data['rg'] = preg_replace('/([^0-9])/i','',$this->request->post['rg']);
					} elseif (isset($customer_info)) {
						$this->data['rg'] = $customer_info['rg'];
					} else {
						$this->data['rg'] = '';
					}
	
					if (isset($this->request->post['cnpj'])) {
						$this->data['cnpj'] = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
					} elseif (isset($customer_info)) {
						$this->data['cnpj'] = $customer_info['cnpj'];
					} else {
						$this->data['cnpj'] = '';
					}
	
					if (isset($this->request->post['razao_social'])) {
						$this->data['razao_social'] = $this->request->post['razao_social'];
					} elseif (isset($customer_info)) {
						$this->data['razao_social'] = $customer_info['razao_social'];
					} else {
						$this->data['razao_social'] = '';
					}
	
					if (isset($this->request->post['inscricao_estadual'])) {
						$this->data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->request->post['inscricao_estadual']);
					} elseif (isset($customer_info)) {
						$this->data['inscricao_estadual'] = $customer_info['inscricao_estadual'];
					} else {
						$this->data['inscricao_estadual'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['email'] = $this->language->get('error_email');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						}
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$this->error['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";  
							}elseif(!$this->isCpf($cpf)){
								$this->error['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$this->error['cnpj'] = "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[$this->data['error_address_address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->error['address_numero'])) {
						$this->data['error_address_numero'] = $this->error['address_numero'];
					} else {
						$this->data['error_address_numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['address_address_1'][$key] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$value['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$this->error['address_numero'][$key] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/Controller/Sale/Customer -->

	<!-- Inicio: Admin/View/Template/Sale/Customer_Form -->
	<file name="admin/view/template/sale/customer_form.tpl">
		<operation>
			<search position="after" index="1"><![CDATA[<?php echo $header; ?>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript">
				 $(document).ready(function() {
					/* Registro - Tipo de Pessoa (PF/PJ) */
					if ($("#fisica").is(':checked')) {
						$('.pessoa_fisica').show();
						$('.pessoa_juridica').hide();    
					}
					if ($("#juridica").is(':checked')) {
						$('.pessoa_fisica').hide();
						$('.pessoa_juridica').show(); 
					}
					$('#juridica').click( function() {
					$('.pessoa_fisica').hide();
						$("#cpf").val("");
						$("#rg").val("");
						$('.pessoa_juridica').show();    
					});
					$('#fisica').click( function() {
					$('.pessoa_fisica').show();
						$("#cnpj").val("");
						$("#razao_social").val("");
						$("#inscricao_estadual").val("");
						$('.pessoa_juridica').hide();
					}); 
				});    
				</script>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="fax" value="<?php echo $fax; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Sexo:</td>
				  <td>
				    <?php if ($sexo == 'm'){ ?>
					<input type="radio" name="sexo" checked value="m">Masculino
					<input type="radio" name="sexo" value="f">Feminino
					<?php }else if($sexo == 'f'){ ?>
					<input type="radio" name="sexo" value="m">Masculino
					<input type="radio" name="sexo" checked value="f">Feminino
					<?php }else{ ?>
					<input type="radio" name="sexo" checked value="m">Masculino
					<input type="radio" name="sexo" value="f">Feminino
					<?php } ?>
			      </td>
			    </tr>
				<tr>
				  <td>Data de Nascimento:</td>
				  <?php
				  $dataparts = explode("-",$data_nascimento);
				  if (sizeof($dataparts) != '3'){
				    $data = $data_nascimento;
				  }else{
				    $data = $dataparts[2]."/".$dataparts[1]."/".$dataparts[0]; 
				  }
				  $data = ($data != '00/00/0000') ? $data : '';
				  ?>
				  <td>
				    <input type="text" name="data_nascimento" value="<?php echo $data; ?>">
				    <?php if ($error_data_nascimento) { ?>
					<span class="error"><?php echo $error_data_nascimento; ?></span>
					<?php } ?>
				  </td>
				</tr>
				<tr>
				  <td>Tipo:</td>
				  <td>
				    <?php if($pessoa == 'fisica'){ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php }else if($pessoa == 'juridica'){ ?>
					<input type="radio" name="pessoa" id="fisica" value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" checked value="juridica">Pessoa Juridica
					<?php }else{ ?>
					<?php if($cpf != ''){ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php }elseif($cnpj != ''){ ?>
					<input type="radio" name="pessoa" id="fisica" value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" checked value="juridica">Pessoa Juridica
					<?php }else{ ?>
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">Pessoa Física
					<input type="radio" id="juridica" name="pessoa" value="juridica">Pessoa Juridica
					<?php } ?>
					<?php } ?>
				</td>
			</tr>
			<tr class="pessoa_fisica">
			  <td><span class="required">*</span> CPF:</td>
			  <td>
			    <input type="text" name="cpf"  id="cpf" value="<?php echo $cpf; ?>" > 
			    <?php if ($error_cpf) { ?>
			    <span class="error"><?php echo $error_cpf; ?></span>
			    <?php } ?>
			  </td>
			</tr>
			<tr class="pessoa_fisica">
			  <td>RG:</td>
			  <td><input type="text" name="rg" id="rg" value="<?php echo $rg; ?>" ></td>
			</tr>
			<tr class="pessoa_juridica">
			  <td><span class="required">*</span> CNPJ:</td>
			  <td>
			    <input type="text" name="cnpj" id="cnpj" value="<?php echo $cnpj; ?>">
			    <?php if ($error_cnpj) { ?>
			    <span class="error"><?php echo $error_cnpj; ?></span>
			    <?php } ?>
			  </td>
			</tr>
			<tr class="pessoa_juridica">
			  <td>Razão Social:</td>
			  <td><input type="text" name="razao_social" id="razao_social" value="<?php echo $razao_social; ?>"></td>
			</tr>
			<tr class="pessoa_juridica">
			  <td>Inscrição Estadual:</td>
			  <td><input type="text" name="inscricao_estadual" id="inscricao_estadual" value="<?php echo $inscricao_estadual; ?>"></td>
			</tr>
			<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="2"><![CDATA[<td><input type="text" name="address[<?php echo $address_row; ?>][firstname]" value="<?php echo $address['firstname']; ?>" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="address[<?php echo $address_row; ?>][apelido]" value="<?php echo $address['apelido']; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<span class="error"><?php echo $error_address_address_1[$address_row]; ?></span>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td>
				    <input type="text" name="address[<?php echo $address_row; ?>][numero]" value="<?php echo $address['numero']; ?>" />
				    <?php if (isset($error_address_numero[$address_row])) { ?>
				    <span class="error"><?php echo $error_address_numero[$address_row]; ?></span>
				    <?php } ?>
				  </td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address[<?php echo $address_row; ?>][address_2]" value="<?php echo $address['address_2']; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="address[<?php echo $address_row; ?>][complemento]" value="<?php echo $address['complemento']; ?>" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[html += '  <input type="hidden" name="address[' + address_row + '][address_id]" value="" />';]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				html += '    <tr>';
				html += '	   <td>Local:</td>';
				html += '	   <td><input type="text" name="address[' + address_row + '][apelido]" value="" /></td>';
				html += '    </tr>';
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[html += '      <td><input type="text" name="address[' + address_row + '][address_1]" value="" /></td>';]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				html += '    <tr>';
				html += '	   <td>Número:</td>';
				html += '	   <td><input type="text" name="address[' + address_row + '][numero]" value="" /></td>';
				html += '    </tr>';
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[html += '      <td><input type="text" name="address[' + address_row + '][address_2]" value="" /></td>';]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				html += '    <tr>';
				html += '	   <td>Complemento:</td>';
				html += '	   <td><input type="text" name="address[' + address_row + '][complemento]" value="" /></td>';
				html += '    </tr>';
				<?php } ?>
			]]></add>
		</operation>
	</file>
	<!-- Fim: Admin/View/Template/Sale/Customer_Form -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Common/Header -->
	<file name="catalog/view/theme/*/template/common/header.tpl">
		<operation>
			<search position="before" index="1"><![CDATA[<script type="text/javascript" src="/catalog/view/javascript/common.js"></script>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript" src="catalog/view/javascript/jquery/jquery.alphanumeric.js"></script>
				<script type="text/javascript" src="catalog/view/javascript/jquery/jquery.maskedinput-1.3.min.js"></script>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<?php echo $google_analytics; ?>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript">
				 $(document).ready(function() {
					/* Registro - Tipo de Pessoa (PF/PJ) */
					if ($("#fisica").is(':checked')) {
						$('.pessoa_fisica').show();
						$('.pessoa_juridica').hide();    
					}
					if ($("#juridica").is(':checked')) {
						$('.pessoa_fisica').hide();
						$('.pessoa_juridica').show();  
					}
					$('#juridica').click( function() {
					$('.pessoa_fisica').hide();
						$("#cpf").val("");
						$("#rg").val("");
						$('.pessoa_juridica').show();    
					});
					$('#fisica').click( function() {
					$('.pessoa_fisica').show();
						$("#cnpj").val("");
						$("#razao_social").val("");
						$("#inscricao_estadual").val("");
						$('.pessoa_juridica').hide();
					});

					/* Mascaras e Formatos */
					if($('input.phone').length > 0) $('input.phone').mask('(99) 9999-9999?9');
					if($('input.date').length > 0) $('input.date').mask('99/99/9999');
					if($('input.cpf').length > 0) $('input.cpf').mask('999.999.999-99');
					if($('input.cnpj').length > 0) $('input.cnpj').mask('99.999.999/9999-99');
					if($('input.alphanumeric').length > 0) $('input.alphanumeric').alphanumeric();
					if($('input.numeric').length > 0) $('input.numeric').numeric();
				});
				</script>
				<?php } ?>
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Common/Header -->

	<!-- Inicio: Catalog/Controller/Account/Edit -->
	<file name="catalog/controller/account/edit.php">
		<operation>
			<search position="before" index="1"><![CDATA[protected function validate() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[$this->data['error_lastname'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->error['data_nascimento'])) {
						$this->data['error_data_nascimento'] = $this->error['data_nascimento'];
					} else {
						$this->data['error_data_nascimento'] = '';
					}
	
					if (isset($this->error['cpf'])) {
						$this->data['error_cpf'] = $this->error['cpf'];
					} else {
						$this->data['error_cpf'] = '';
					}
	
					if (isset($this->error['cnpj'])) {
						$this->data['error_cnpj'] = $this->error['cnpj'];
					} else {
						$this->data['error_cnpj'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['telephone'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->request->post['pessoa'])) {
						$this->data['pessoa'] = $this->request->post['pessoa'];
					} else {
						$this->data['pessoa'] = '';
					}

					if (isset($this->request->post['sexo'])) {
						$this->data['sexo'] = $this->request->post['sexo'];
					} elseif (isset($customer_info)) {
						$this->data['sexo'] = $customer_info['sexo'];
					} else {
						$this->data['sexo'] = '';
					}
	
					if (isset($this->request->post['data_nascimento'])) {
						$this->data['data_nascimento'] = $this->request->post['data_nascimento'];
					} elseif (isset($customer_info)) {
						$this->data['data_nascimento'] = $customer_info['data_nascimento'];
					} else {
						$this->data['data_nascimento'] = '';
					}
	
					if (isset($this->request->post['cpf'])) {
						$this->data['cpf'] = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
					} elseif (isset($customer_info)) {
						$this->data['cpf'] = $customer_info['cpf'];
					} else {
						$this->data['cpf'] = '';
					}
	
					if (isset($this->request->post['rg'])) {
						$this->data['rg'] = preg_replace('/([^0-9])/i','',$this->request->post['rg']);
					} elseif (isset($customer_info)) {
						$this->data['rg'] = $customer_info['rg'];
					} else {
						$this->data['rg'] = '';
					}
	
					if (isset($this->request->post['cnpj'])) {
						$this->data['cnpj'] = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
					} elseif (isset($customer_info)) {
						$this->data['cnpj'] = $customer_info['cnpj'];
					} else {
						$this->data['cnpj'] = '';
					}
	
					if (isset($this->request->post['razao_social'])) {
						$this->data['razao_social'] = $this->request->post['razao_social'];
					} elseif (isset($customer_info)) {
						$this->data['razao_social'] = $customer_info['razao_social'];
					} else {
						$this->data['razao_social'] = '';
					}
	
					if (isset($this->request->post['inscricao_estadual'])) {
						$this->data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->request->post['inscricao_estadual']);
					} elseif (isset($customer_info)) {
						$this->data['inscricao_estadual'] = $customer_info['inscricao_estadual'];
					} else {
						$this->data['inscricao_estadual'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['email'] = $this->language->get('error_email');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						} 
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$this->error['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";  
							}elseif(!$this->isCpf($cpf)){
								$this->error['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$this->error['cnpj'] = "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>	 
	</file>
	<!-- Fim: Catalog/Controller/Account/Edit -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Account/Edit -->
	<file name="catalog/view/theme/*/template/account/edit.tpl">
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="fax" value="<?php echo $fax; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				
				  <td>Sexo:</td>
				  <td>
				    <?php if ($sexo == 'f'){ ?>
					<input type="radio" name="sexo" checked value="f">Feminino
					<input type="radio" name="sexo" value="m">Masculino
					<?php }else if($sexo == 'm'){ ?>
					<input type="radio" name="sexo" value="f">Feminino
					<input type="radio" name="sexo" checked value="m">Masculino
					<?php }else{ ?>
					<input type="radio" name="sexo" checked value="f">Feminino
					<input type="radio" name="sexo" value="m">Masculino
					<?php } ?>
				  </td>
				</tr>
				<tr>
				  <td>Data de Nascimento:</td>
				  <?php 
				  $dataparts = explode("-",$data_nascimento);
				  if (sizeof($dataparts) != '3'){
					  $data = $data_nascimento;
				  }else{
					  $data = $dataparts[2]."/".$dataparts[1]."/".$dataparts[0]; 
				  }
				  $data = ($data != '00/00/0000') ? $data : '';
				  ?>
				  <td><input type="text" name="data_nascimento" value="<?php echo $data; ?>" class="date" />
				  <?php if ($error_data_nascimento) { ?>
				  <span class="error"><?php echo $error_data_nascimento; ?></span>
				  <?php } ?>
				  </td>
				
				  <td><span class="required">*</span> CPF:</td>
				  <td>
				    <input type="text" name="cpf" id="cpf" value="<?php echo $cpf; ?>" class="cpf" />
					<?php if ($error_cpf) { ?>
					<span class="error"><?php echo $error_cpf; ?></span>
					<?php } ?>
				  </td>
				</tr>
				<tr class="pessoa_fisica">
				  <td>RG:</td>
				  <td><input type="text" name="rg" id="rg" value="<?php echo $rg; ?>" class="numeric" /></td>
				</tr>
				
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="telephone" value="<?php echo $telephone; ?>" />]]></search>
			<add><![CDATA[
				<input type="text" name="telephone" value="<?php echo $telephone; ?>" class="phone" />
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="fax" value="<?php echo $fax; ?>" />]]></search>
			<add><![CDATA[
				<input type="text" name="fax" value="<?php echo $fax; ?>" class="phone" />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Account/Edit -->

	<!-- Inicio: Catalog/Model/Account/Address -->
	<file name="catalog/model/account/address.php">
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$this->customer->getId() . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$data['apelido']   = ucwords(strtr(strtolower($data['apelido']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['firstname'] = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']  = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_1'] = ucwords(strtr(strtolower($data['address_1']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_2'] = ucwords(strtr(strtolower($data['address_2']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['city']      = ucwords(strtr(strtolower($data['city']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['numero']    = preg_replace('/([^0-9])/i','',$data['numero']);
					$data['postcode']  = preg_replace('/([^0-9])/i','',$data['postcode']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$this->customer->getId() . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "', apelido = '" . $this->db->escape($data['apelido']) . "', numero = '" . $this->db->escape($data['numero']) . "', complemento = '" . $this->db->escape($data['complemento']) . "'");
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$this->customer->getId() . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "address SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "' WHERE address_id  = '" . (int)$address_id . "' AND customer_id = '" . (int)$this->customer->getId() . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$data['apelido']   = ucwords(strtr(strtolower($data['apelido']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['firstname'] = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']  = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_1'] = ucwords(strtr(strtolower($data['address_1']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_2'] = ucwords(strtr(strtolower($data['address_2']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['city']      = ucwords(strtr(strtolower($data['city']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['numero']    = preg_replace('/([^0-9])/i','',$data['numero']);
					$data['postcode']  = preg_replace('/([^0-9])/i','',$data['postcode']);

					$this->db->query("UPDATE " . DB_PREFIX . "address SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "', apelido = '" . $this->db->escape($data['apelido']) . "', numero = '" . $this->db->escape($data['numero']) . "', complemento = '" . $this->db->escape($data['complemento']) . "' WHERE address_id  = '" . (int)$address_id . "' AND customer_id = '" . (int)$this->customer->getId() . "'");
				}else{
					$this->db->query("UPDATE " . DB_PREFIX . "address SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape(isset($data['company_id']) ? $data['company_id'] : '') . "', tax_id = '" . $this->db->escape(isset($data['tax_id']) ? $data['tax_id'] : '') . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', city = '" . $this->db->escape($data['city']) . "', zone_id = '" . (int)$data['zone_id'] . "', country_id = '" . (int)$data['country_id'] . "' WHERE address_id  = '" . (int)$address_id . "' AND customer_id = '" . (int)$this->customer->getId() . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['address_2'      => $address_query->row['address_2'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $address_query->row['complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['address_2'      => $result['address_2'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $result['apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $result['numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $result['complemento'] : '',
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Model/Account/Address -->

	<!-- Inicio: Catalog/Controller/Account/Address -->
	<file name="catalog/controller/account/address.php">
		<operation>
			<search position="replace" index="1"><![CDATA[$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';]]></search>
			<add><![CDATA[
				$format = '{apelido}' . "\n" . '{company}' . "\n" . '{firstname} {lastname}' . "\n" . '{address_1}, {complemento}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['{firstname}',]]></search>
			<add><![CDATA[
				'{apelido}',
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['{address_2}',]]></search>
			<add><![CDATA[
				'{complemento}',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $result['firstname'],]]></search>
			<add><![CDATA[
				'apelido' => ($this->config->get('fields_register_brazil_status')) ? $result['apelido'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA['address_1' => $result['address_1'],]]></search>
			<add><![CDATA[
				'address_1' => ($this->config->get('fields_register_brazil_status')) ? $result['address_1'] . ', ' . $result['numero'] : $result['address_1'],
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['address_2' => $result['address_2'],]]></search>
			<add><![CDATA[
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $result['complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['error_address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->error['numero'])) {
						$this->data['error_numero'] = $this->error['numero'];
					} else {
						$this->data['error_numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_2'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['apelido'])) {
						$this->data['apelido'] = $this->request->post['apelido'];
					} elseif (isset($address_info)) {
						$this->data['apelido'] = $address_info['apelido'];
					} else {
						$this->data['apelido'] = '';
					}

					if (isset($this->request->post['numero'])) {
						$this->data['numero'] = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					} elseif (isset($address_info)) {
						$this->data['numero'] = $address_info['numero'];
					} else {
						$this->data['numero'] = '';
					}

					if (isset($this->request->post['complemento'])) {
						$this->data['complemento'] = $this->request->post['complemento'];
					} elseif (isset($address_info)) {
						$this->data['complemento'] = $address_info['complemento'];
					} else {
						$this->data['complemento'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$this->error['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Account/Address -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Account/Address_Form -->
	<file name="catalog/view/theme/*/template/account/address_form.tpl">
		<operation>
			<search position="before" index="1" offset="1"><![CDATA[<td><span class="required">*</span> <?php echo $entry_firstname; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="apelido" value="<?php echo $apelido; ?>" /><span class="field-info">&nbsp;(Ex: Casa, Trabalho, etc)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<span class="error"><?php echo $error_address_1; ?></span>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td><input type="text" name="numero" value="<?php echo $numero; ?>" class="numeric" />
					<?php if ($error_numero) { ?>
					<span class="error"><?php echo $error_numero; ?></span>
					<?php } ?></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address_2" value="<?php echo $address_2; ?>" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="complemento" value="<?php echo $complemento; ?>" /><span class="field-info">&nbsp;(Ex: Ap. 105)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="<?php echo $postcode; ?>" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="numeric" />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Account/Address_Form -->

	<!-- Inicio: Catalog/Model/Account/Customer -->
	<file name="catalog/model/account/customer.php">
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET store_id = '" . (int)$this->config->get('config_store_id') . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', newsletter = '" . (isset($data['newsletter']) ? (int)$data['newsletter'] : 0) . "', customer_group_id = '" . (int)$customer_group_id . "', ip = '" . $this->db->escape($this->request->server['REMOTE_ADDR']) . "', status = '1', approved = '" . (int)!$customer_group_info['approval'] . "', date_added = NOW()");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if ($data['data_nascimento'] == ""){
						$dataparts[0] = "00";
						$dataparts[1] = "00";
						$dataparts[2] = "0000";
					}else{
						$dataparts = explode("/",$data['data_nascimento']);
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET store_id = '" . (int)$this->config->get('config_store_id') . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', newsletter = '" . (isset($data['newsletter']) ? (int)$data['newsletter'] : 0) . "', customer_group_id = '" . (int)$customer_group_id . "', ip = '" . $this->db->escape($this->request->server['REMOTE_ADDR']) . "', status = '1', approved = '" . (int)!$customer_group_info['approval'] . "', date_added = NOW(), cpf = '" . $this->db->escape($data['cpf']) . "', rg = '" . $this->db->escape($data['rg']) . "', cnpj = '" . $this->db->escape($data['cnpj']) . "', razao_social = '" . $this->db->escape($data['razao_social']) . "', inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "', data_nascimento = '" . $this->db->escape($dataparts[2]."-".$dataparts[1]."-".$dataparts[0]) . "', sexo = '" . $this->db->escape($data['sexo']) . "'");
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "customer SET store_id = '" . (int)$this->config->get('config_store_id') . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', salt = '" . $this->db->escape($salt = substr(md5(uniqid(rand(), true)), 0, 9)) . "', password = '" . $this->db->escape(sha1($salt . sha1($salt . sha1($data['password'])))) . "', newsletter = '" . (isset($data['newsletter']) ? (int)$data['newsletter'] : 0) . "', customer_group_id = '" . (int)$customer_group_id . "', ip = '" . $this->db->escape($this->request->server['REMOTE_ADDR']) . "', status = '1', approved = '" . (int)!$customer_group_info['approval'] . "', date_added = NOW()");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "' WHERE customer_id = '" . (int)$this->customer->getId() . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if ($data['data_nascimento'] == ""){
						$dataparts[0] = "00";
						$dataparts[1] = "00";
						$dataparts[2] = "0000";
					}else{
						$dataparts = explode("/",$data['data_nascimento']);
					}

					$data['firstname']          = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($data['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$data['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$data['fax']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$data['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$data['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$data['cnpj']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$data['inscricao_estadual']);

					$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', cpf = '" . $this->db->escape($data['cpf']) . "', rg = '" . $this->db->escape($data['rg']) . "', cnpj = '" . $this->db->escape($data['cnpj']) . "', razao_social = '" . $this->db->escape($data['razao_social']) . "', inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "', data_nascimento = '" . $this->db->escape($dataparts[2]."-".$dataparts[1]."-".$dataparts[0]) . "', sexo = '" . $this->db->escape($data['sexo']) . "', fax = '" . $this->db->escape($data['fax']) . "' WHERE customer_id = '" . (int)$this->customer->getId() . "'");
				}else{
					$this->db->query("UPDATE " . DB_PREFIX . "customer SET firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "' WHERE customer_id = '" . (int)$this->customer->getId() . "'");
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape($data['company_id']) . "', tax_id = '" . $this->db->escape($data['tax_id']) . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', city = '" . $this->db->escape($data['city']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', country_id = '" . (int)$data['country_id'] . "', zone_id = '" . (int)$data['zone_id'] . "'");]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$data['apelido']   = ucwords(strtr(strtolower($data['apelido']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['firstname'] = ucwords(strtr(strtolower($data['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']  = ucwords(strtr(strtolower($data['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_1'] = ucwords(strtr(strtolower($data['address_1']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['address_2'] = ucwords(strtr(strtolower($data['address_2']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['city']      = ucwords(strtr(strtolower($data['city']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['numero']    = preg_replace('/([^0-9])/i','',$data['numero']);
					$data['postcode']  = preg_replace('/([^0-9])/i','',$data['postcode']);

					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape($data['company_id']) . "', tax_id = '" . $this->db->escape($data['tax_id']) . "', apelido = '" . $this->db->escape($data['apelido']) . "', address_1 = '" . $this->db->escape($data['address_1']) . "', numero = '" . $this->db->escape($data['numero']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', complemento = '" . $this->db->escape($data['complemento']) . "', city = '" . $this->db->escape($data['city']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', country_id = '" . (int)$data['country_id'] . "', zone_id = '" . (int)$data['zone_id'] . "'");
				}else{
					$this->db->query("INSERT INTO " . DB_PREFIX . "address SET customer_id = '" . (int)$customer_id . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', company = '" . $this->db->escape($data['company']) . "', company_id = '" . $this->db->escape($data['company_id']) . "', tax_id = '" . $this->db->escape($data['tax_id']) . "', address_1 = '" . $this->db->escape($data['address_1']) . "', address_2 = '" . $this->db->escape($data['address_2']) . "', city = '" . $this->db->escape($data['city']) . "', postcode = '" . $this->db->escape($data['postcode']) . "', country_id = '" . (int)$data['country_id'] . "', zone_id = '" . (int)$data['zone_id'] . "'");
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Model/Account/Customer -->

	<!-- Inicio: Catalog/Controller/Account/Register -->
	<file name="catalog/controller/account/register.php">
		<operation>
			<search position="before" index="1"><![CDATA[public function country() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[$this->data['error_lastname'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->error['data_nascimento'])) {
						$this->data['error_data_nascimento'] = $this->error['data_nascimento'];
					} else {
						$this->data['error_data_nascimento'] = '';
					}

					if (isset($this->error['cpf'])) {
						$this->data['error_cpf'] = $this->error['cpf'];
					} else {
						$this->data['error_cpf'] = '';
					}

					if (isset($this->error['cnpj'])) {
						$this->data['error_cnpj'] = $this->error['cnpj'];
					} else {
						$this->data['error_cnpj'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['telephone'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->request->post['pessoa'])) {
						$this->data['pessoa'] = $this->request->post['pessoa'];
					} else {
						$this->data['pessoa'] = '';
					}

					if (isset($this->request->post['sexo'])) {
						$this->data['sexo'] = $this->request->post['sexo'];
					} else {
						$this->data['sexo'] = '';
					}

					if (isset($this->request->post['data_nascimento'])) {
						$this->data['data_nascimento'] = $this->request->post['data_nascimento'];
					} else {
						$this->data['data_nascimento'] = '';
					}

					if (isset($this->request->post['cpf'])) {
						$this->data['cpf'] = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
					} else {
						$this->data['cpf'] = '';
					}

					if (isset($this->request->post['rg'])) {
						$this->data['rg'] = preg_replace('/([^0-9])/i','',$this->request->post['rg']);
					} else {
						$this->data['rg'] = '';
					}

					if (isset($this->request->post['cnpj'])) {
						$this->data['cnpj'] = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
					} else {
						$this->data['cnpj'] = '';
					}

					if (isset($this->request->post['razao_social'])) {
						$this->data['razao_social'] = $this->request->post['razao_social'];
					} else {
						$this->data['razao_social'] = '';
					}

					if (isset($this->request->post['inscricao_estadual'])) {
						$this->data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->request->post['inscricao_estadual']);
					} else {
						$this->data['inscricao_estadual'] = '';
					}
				}	
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->error['email'] = $this->language->get('error_email');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$this->error['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						}
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$this->error['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";  
							}elseif(!$this->isCpf($cpf)){
								$this->error['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$this->error['cnpj'] = "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['error_address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->error['numero'])) {
						$this->data['error_numero'] = $this->error['numero'];
					} else {
						$this->data['error_numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					if (isset($this->request->post['apelido'])) {
						$this->data['apelido'] = $this->request->post['apelido'];
					} else {
						$this->data['apelido'] = '';
					}

					if (isset($this->request->post['numero'])) {
						$this->data['numero'] = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					} else {
						$this->data['numero'] = '';
					}

					if (isset($this->request->post['complemento'])) {
						$this->data['complemento'] = $this->request->post['complemento'];
					} else {
						$this->data['complemento'] = '';
					}
				}
			]]></add>
		</operation>	
			
	</file>
	<!-- Fim: Catalog/Controller/Account/Register -->

	<!-- Inicio: Catalog/Model/Account/Order -->
	<file name="catalog/model/account/order.php">
		<operation>
			<search position="before" index="1"><![CDATA['shipping_firstname'      => $order_query->row['shipping_firstname'],]]></search>
			<add><![CDATA[
				'shipping_apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_apelido'] : '',
				'shipping_numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_numero'] : '',
				'shipping_complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['payment_firstname'       => $order_query->row['payment_firstname'],]]></search>
			<add><![CDATA[
				'payment_apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_apelido'] : '',
				'payment_numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_numero'] : '',
				'payment_complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_complemento'] : '',
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Model/Account/Order -->

	<!-- Inicio: Catalog/Controller/Account/Order -->
	<file name="catalog/controller/account/order.php">
		<operation>
			<search position="replace" index="1,2"><![CDATA[$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$format = '{apelido}' . "\n" . '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}, {numero}, {complemento}' . "\n" . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}else{
					$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1,2"><![CDATA['{firstname}',]]></search>
			<add><![CDATA[
				'{apelido}',
				'{numero}',
				'{complemento}',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['shipping_firstname'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['payment_firstname'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_complemento'] : '',
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Account/Order -->

	<!-- Inicio: Catalog/Controller/Checkout/Register -->
	<file name="catalog/controller/checkout/register.php">
		<operation>
			<search position="before" index="1"><![CDATA[public function validate() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$json['error']['email'] = $this->language->get('error_email');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$json['error']['data_nascimento']  = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$json['error']['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						}
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$json['error']['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";
							}elseif(!$this->isCpf($cpf)){
								$json['error']['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$json['error']['cnpj'] =  "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$json['error']['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$json['error']['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Register -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Register -->
	<file name="catalog/view/theme/*/template/checkout/register.tpl">
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="fax" value="" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
					<script type="text/javascript">
					$(function(){
						/* Registro - Tipo de Pessoa (PF/PJ) */
						$('.pessoa_fisica').show();
						$('.pessoa_juridica').hide();

						$('#juridica').click( function() {
						$('.pessoa_fisica').hide();
							$("#cpf").val("");
							$("#rg").val("");
							$('.pessoa_juridica').show();
						});
						$('#fisica').click( function() {
						$('.pessoa_fisica').show();
							$("#cnpj").val("");
							$("#razao_social").val("");
							$("#inscricao_estadual").val("");
							$('.pessoa_juridica').hide();
						});

						/* Mascaras e Formatos */
						if($('input.phone').length > 0) $('input.phone').mask('(99) 9999-9999?9');
						if($('input.date').length > 0) $('input.date').mask('99/99/9999');
						if($('input.cpf').length > 0) $('input.cpf').mask('999.999.999-99');
						if($('input.cnpj').length > 0) $('input.cnpj').mask('99.999.999/9999-99');
						if($('input.alphanumeric').length > 0) $('input.alphanumeric').alphanumeric();
						if($('input.numeric').length > 0) $('input.numeric').numeric();
					});
					</script>
					Sexo:<br />
					<input type="radio" name="sexo" checked value="m">Masculino
					<input type="radio" name="sexo" value="f">Feminino
					<br /><br />Data de Nascimento:<br />
					<input type="text" name="data_nascimento" class="large-field date" /><br />
					<div class="some">Tipo:<br />
					<input type="radio" name="pessoa" id="fisica" checked value="fisica">
					Pessoa Física 
					<input type="radio" id="juridica" name="pessoa" value="juridica">
					Pessoa Juridica</div>
					<div class="pessoa_fisica">
					  <br /><span class="required">*</span> CPF:<br />
					  <input type="text" name="cpf" id="cpf" class="large-field cpf" required/><br /><br />
					  RG:<br />
					  <input type="text" name="rg" id="rg" class="large-field numeric" /><br /><br />
					</div>
					<div class="pessoa_juridica">
					  <br /><span class="required">*</span> CNPJ:<br />
					  <input type="text" name="cnpj" id="cnpj" class="large-field cnpj" /><br /><br /><br />
					  Razão Social:<br />
					  <input type="text" name="razao_social" id="razao_social" class="large-field" /><br /><br />
					  Inscrição Estadual:<br />
					  <input type="text" name="inscricao_estadual" id="inscricao_estadual" class="large-field alphanumeric" /><br /><span class="field-info">(apenas números e letras)</span>
					  <br />
					  <br />
					</div>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<h2><?php echo $text_your_address; ?></h2>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				Local:<br />
				<input type="text" name="apelido" value="" class="large-field" /><br /><span class="field-info">(Ex: Casa, Trabalho, etc)</span>
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="address_1" value="" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<span class="required">*</span> Número:<br />
				<input type="text" name="numero" value="" class="large-field numeric" required/>
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="address_2" value="" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				Complemento:<br />
				<input type="text" name="complemento" value="" class="large-field" /><br /><span class="field-info">&nbsp;(Ex: Ap. 105)</span>
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="fax" value="" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="fax" value="" class="large-field phone" /><br />
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field numeric" /><br />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Register -->

	<!-- Inicio: Catalog/Controller/Checkout/Guest -->
	<file name="catalog/controller/checkout/guest.php">
		<operation>
			<search position="before" index="1"><![CDATA[public function validate() {]]></search>
			<add><![CDATA[
				public function isCpf($cpf){
					$cpf        = preg_replace('/([^0-9])/i','',$cpf);
					$digitoUm   = 0;
					$digitoDois = 0;
				
					for($i = 0, $x = 10; $i <= 8; $i++, $x--){
						$digitoUm += $cpf[$i] * $x;
					}
				
					for($i = 0, $x = 11; $i <= 9; $i++, $x--){
						if(str_repeat($i, 11) == $cpf){
							return false;
						}
						$digitoDois += $cpf[$i] * $x;
					}
				
					$calculoUm   = (($digitoUm % 11) < 2) ? 0 : 11 - ($digitoUm % 11);
					$calculoDois = (($digitoDois % 11) < 2) ? 0 : 11 - ($digitoDois % 11);
				
					if($calculoUm != $cpf[9] || $calculoDois != $cpf[10]){
						return false;
					}
				
					return true;
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['telephone'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['pessoa'])) {
						$this->data['pessoa'] = $this->session->data['guest']['pessoa'];
					} else {
						$this->data['pessoa'] = '';
					}

					if (isset($this->session->data['guest']['sexo'])) {
						$this->data['sexo'] = $this->session->data['guest']['sexo'];
					} else {
						$this->data['sexo'] = '';
					}

					if (isset($this->session->data['guest']['data_nascimento'])) {
						$this->data['data_nascimento'] = $this->session->data['guest']['data_nascimento'];
					} else {
						$this->data['data_nascimento'] = '';
					}

					if (isset($this->session->data['guest']['cpf'])) {
						$this->data['cpf'] = preg_replace('/([^0-9])/i','',$this->session->data['guest']['cpf']);
					} else {
						$this->data['cpf'] = '';
					}

					if (isset($this->session->data['guest']['rg'])) {
						$this->data['rg'] = preg_replace('/([^0-9])/i','',$this->session->data['guest']['rg']);
					} else {
						$this->data['rg'] = '';
					}

					if (isset($this->session->data['guest']['cnpj'])) {
						$this->data['cnpj'] = preg_replace('/([^0-9])/i','',$this->session->data['guest']['cnpj']);
					} else {
						$this->data['cnpj'] = '';
					}

					if (isset($this->session->data['guest']['razao_social'])) {
						$this->data['razao_social'] = $this->session->data['guest']['razao_social'];
					} else {
						$this->data['razao_social'] = '';
					}

					if (isset($this->session->data['guest']['inscricao_estadual'])) {
						$this->data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->session->data['guest']['inscricao_estadual']);
					} else {
						$this->data['inscricao_estadual'] = '';
					}
				}	
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['fax'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['payment']['apelido'])) {
					    $this->data['apelido'] = $this->session->data['guest']['payment']['apelido'];			
					} else {
					    $this->data['apelido'] = '';
					}
				}	
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['payment']['numero'])) {
					    $this->data['numero'] = $this->session->data['guest']['payment']['numero'];			
					} else {
					    $this->data['numero'] = '';
					}
				}	
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_2'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['payment']['complemento'])) {
					    $this->data['complemento'] = $this->session->data['guest']['payment']['complemento'];			
					} else {
					    $this->data['complemento'] = '';
					}
				}	
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$json['error']['email'] = $this->language->get('error_email');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){ 
					// Valida campo Data de Nascimento
					$dataparts = explode("/",$this->request->post['data_nascimento']);
					if (strlen(utf8_decode($this->request->post['data_nascimento'])) > 0) {
						// Se o array não tiver 3 posições a data esta incorreta
						if (sizeof($dataparts) != '3'){
							$json['error']['data_nascimento']  = "Atenção: A data informada é inválida";
						}else{
							// Checa validade da data
							if (!checkdate($dataparts[1],$dataparts[0],$dataparts[2])) {
								$json['error']['data_nascimento'] = "Atenção: A data informada é inválida";
							}
						}
					}

					// Valida CPF e CNPJ
					if ($this->request->post['pessoa'] == "fisica"){
						if(isset($this->request->post['cpf'])){
							$cpf = preg_replace('/([^0-9])/i','',$this->request->post['cpf']);
							if ((strlen(utf8_decode($cpf)) < 1) || (strlen(utf8_decode($cpf)) > 14)) {
								$json['error']['cpf'] = "Atenção: O CPF não deve passar de 14 caracteres";
							}elseif(!$this->isCpf($cpf)){
								$json['error']['cpf'] = "Atenção: O CPF informado é inválido";
							}
						}
					}else if ($this->request->post['pessoa'] == "juridica"){
						if(isset($this->request->post['cnpj'])){
							$cnpj = preg_replace('/([^0-9])/i','',$this->request->post['cnpj']);
							if ((strlen(utf8_decode($cnpj)) < 1) || (strlen(utf8_decode($cnpj)) > 18)&&($this->request->post['pessoa'] == "juridica")) {
								$json['error']['cnpj'] =  "Atenção: O CNPJ não deve passar de 18 caracteres";
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$json['error']['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$json['error']['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['telephone'] = $this->request->post['telephone'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['pessoa']             = $this->request->post['pessoa'];
				$this->session->data['guest']['sexo']               = $this->request->post['sexo'];
				$this->session->data['guest']['data_nascimento']    = $this->request->post['data_nascimento'];
				$this->session->data['guest']['cpf']                = $this->request->post['cpf'];
				$this->session->data['guest']['rg']                 = $this->request->post['rg'];
				$this->session->data['guest']['cnpj']               = $this->request->post['cnpj'];
				$this->session->data['guest']['razao_social']       = $this->request->post['razao_social'];
				$this->session->data['guest']['inscricao_estadual'] = $this->request->post['inscricao_estadual'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['payment']['lastname'] = $this->request->post['lastname'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['payment']['apelido'] = $this->request->post['apelido'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['payment']['address_1'] = $this->request->post['address_1'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['payment']['numero'] = $this->request->post['numero'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['payment']['address_2'] = $this->request->post['address_2'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['payment']['complemento'] = $this->request->post['complemento'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['lastname'] = $this->request->post['lastname'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['apelido'] = $this->request->post['apelido'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['address_1'] = $this->request->post['address_1'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['numero'] = $this->request->post['numero'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['address_2'] = $this->request->post['address_2'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['complemento'] = $this->request->post['complemento'];
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Guest -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Guest -->
	<file name="catalog/view/theme/*/template/checkout/guest.tpl">
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="fax" value="<?php echo $fax; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
					<script type="text/javascript">
					$(function(){
						/* Registro - Tipo de Pessoa (PF/PJ) */
						if ($("#fisica").is(':checked')) {
							$('.pessoa_fisica').show();
							$('.pessoa_juridica').hide();    
						}
						if ($("#juridica").is(':checked')) {
							$('.pessoa_fisica').hide();
							$('.pessoa_juridica').show(); 
						}

						$('#juridica').click( function() {
							$('.pessoa_fisica').hide();
							$("#cpf").val("");
							$("#rg").val("");
							$('.pessoa_juridica').show();
						});
						$('#fisica').click( function() {
							$('.pessoa_fisica').show();
							$("#cnpj").val("");
							$("#razao_social").val("");
							$("#inscricao_estadual").val("");
							$('.pessoa_juridica').hide();
						});

						/* Mascaras e Formatos */
						if($('input.phone').length > 0) $('input.phone').mask('(99) 9999-9999?9');
						if($('input.date').length > 0) $('input.date').mask('99/99/9999');
						if($('input.cpf').length > 0) $('input.cpf').mask('999.999.999-99');
						if($('input.cnpj').length > 0) $('input.cnpj').mask('99.999.999/9999-99');
						if($('input.alphanumeric').length > 0) $('input.alphanumeric').alphanumeric();
						if($('input.numeric').length > 0) $('input.numeric').numeric();
					});
					</script>
					Sexo:<br />
					<input type="radio" name="sexo" value="m"<?php echo ($sexo == 'm' || $sexo == '') ? ' checked' : ''; ?>>Masculino
					<input type="radio" name="sexo" value="f"<?php echo ($sexo == 'f') ? ' checked' : ''; ?>>Feminino
					<br /><br />Data de Nascimento:<br />
					<input type="text" name="data_nascimento" value="<?php echo $data_nascimento; ?>" class="large-field date" /><br /><br />
					Tipo:<br />
					<input type="radio" name="pessoa" id="fisica" value="fisica"<?php echo ($pessoa == 'fisica' || $pessoa == '') ? ' checked' : ''; ?>>
					Pessoa Física 
					<input type="radio" id="juridica" name="pessoa" value="juridica"<?php echo ($pessoa == 'juridica') ? ' checked' : ''; ?>>
					Pessoa Juridica
					<div class="pessoa_fisica">
					  <br /><span class="required">*</span> CPF:<br />
					  <input type="text" name="cpf" id="cpf" value="<?php echo $cpf; ?>" class="large-field cpf" /><br /><br /><br />
					  RG:<br />
					  <input type="text" name="rg" id="rg" value="<?php echo $rg; ?>" class="large-field numeric" /><br /><br /><br />
					</div>
					<div class="pessoa_juridica">
					  <br /><span class="required">*</span> CNPJ:<br />
					  <input type="text" name="cnpj" id="cnpj" value="<?php echo $cnpj; ?>" class="large-field cnpj" /><br /><br /><br />
					  Razão Social:<br />
					  <input type="text" name="razao_social" id="razao_social" value="" class="large-field" /><br /><br />
					  Inscrição Estadual:<br />
					  <input type="text" name="inscricao_estadual" id="inscricao_estadual" value="<?php echo $inscricao_estadual; ?>" class="large-field alphanumeric" /><br /><span class="field-info">(apenas números e letras)</span>
					  <br />
					  <br />
					</div>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<h2><?php echo $text_your_address; ?></h2>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				Local:<br />
				<input type="text" name="apelido" value="<?php echo $apelido; ?>" class="large-field" /><br /><span class="field-info">(Ex: Casa, Trabalho, etc)</span>
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="address_1" value="<?php echo $address_1; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<span class="required">*</span> Número:<br />
				<input type="text" name="numero" value="<?php echo $numero; ?>" class="large-field numeric" /><br />
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[<input type="text" name="address_2" value="<?php echo $address_2; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				Complemento:<br />
				<input type="text" name="complemento" value="<?php echo $complemento; ?>" class="large-field" /><br /><span class="field-info">&nbsp;(Ex: Ap. 105)</span>
				<br />
				<br />
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="telephone" value="<?php echo $telephone; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="telephone" value="<?php echo $telephone; ?>" class="large-field phone" /><br />
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="fax" value="<?php echo $fax; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="fax" value="<?php echo $fax; ?>" class="large-field phone" /><br />
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field numeric" /><br />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Guest -->
	
	<!-- Inicio: Catalog/Controller/Checkout/Guest_Shipping -->
	<file name="catalog/controller/checkout/guest_shipping.php">
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['lastname'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['shipping']['apelido'])) {
					    $this->data['apelido'] = $this->session->data['guest']['shipping']['apelido'];
					} else {
					    $this->data['apelido'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_1'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['shipping']['numero'])) {
					    $this->data['numero'] = $this->session->data['guest']['shipping']['numero'];
					} else {
					    $this->data['numero'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->data['address_2'] = '';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					if (isset($this->session->data['guest']['shipping']['complemento'])) {
					    $this->data['complemento'] = $this->session->data['guest']['shipping']['complemento'];
					} else {
					    $this->data['complemento'] = '';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$json['error']['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$json['error']['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['lastname'] = trim($this->request->post['lastname']);]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['apelido'] = trim($this->request->post['apelido']);
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['address_1'] = $this->request->post['address_1'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['numero'] = $this->request->post['numero'];
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$this->session->data['guest']['shipping']['address_2'] = $this->request->post['address_2'];]]></search>
			<add><![CDATA[
				$this->session->data['guest']['shipping']['complemento'] = $this->request->post['complemento'];
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Guest_Shipping -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Guest_Shipping -->
	<file name="catalog/view/theme/*/template/checkout/guest_shipping.tpl">
		<operation>
			<search position="top"><![CDATA[]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
					<script type="text/javascript">
					$(function(){
						/* Mascaras e Formatos */
						if($('input.numeric').length > 0) $('input.numeric').numeric();
					});
					</script>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<td><input type="text" name="lastname" value="<?php echo $lastname; ?>" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local</td>
				  <td><input type="text" name="apelido" value="<?php echo $apelido; ?>" class="large-field" /><span class="field-info">&nbsp;(Ex: Casa, Trabalho, etc)</span></td></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<td><input type="text" name="address_1" value="<?php echo $address_1; ?>" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número</td>
				  <td><input type="text" name="numero" value="<?php echo $numero; ?>" class="large-field numeric" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[<td><input type="text" name="lastname" value="<?php echo $lastname; ?>" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento</td>
				  <td><input type="text" name="complemento" value="<?php echo $complemento; ?>" class="large-field" /><span class="field-info">&nbsp;(Ex: Ap. 105)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field numeric" />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Guest_Shipping -->

	<!-- Inicio: Catalog/Controller/Checkout/Payment_Address -->
	<file name="catalog/controller/checkout/payment_address.php">
		<operation>
			<search position="before" index="1" offset="1"><![CDATA[$json['error']['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$json['error']['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Payment_Address -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Payment_Address -->
	<file name="catalog/view/theme/*/template/checkout/payment_address.tpl">
		<operation>
			<search position="before" index="1"><![CDATA[<?php if ($addresses) { ?>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript">
				$(function(){
					// Mascaras e Formatos
					if($('input.numeric').length > 0) $('input.numeric').numeric();
					if($('input.alpha').length > 0) $('input.alpha').alpha();
					if($('input.alphanumeric').length > 0) $('input.alphanumeric').alphanumeric();
				});
				</script>
				<?php }?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php
				$apelido     = ($address['apelido'] != '') ? '('. $address['apelido'] .') ' : '';
				$bairro      = ($address['address_2'] != '') ? ', ' . $address['address_2'] : '';
				$complemento = ($address['complemento'] != '') ? ', ' . $address['complemento'] : '';
				?>
				<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $apelido . $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['numero'] . $bairro . $complemento; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php }else{ ?>
				<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php } ?>
			]]></add>
		</operation>		
		<operation>
			<search position="replace" index="1"><![CDATA[<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php
				$apelido     = ($address['apelido'] != '') ? '('. $address['apelido'] .') ' : '';
				$bairro      = ($address['address_2'] != '') ? ', ' . $address['address_2'] : '';
				$complemento = ($address['complemento'] != '') ? ', ' . $address['complemento'] : '';
				?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $apelido . $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['numero'] . $bairro . $complemento; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php }else{ ?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="1"><![CDATA[<td><span class="required">*</span> <?php echo $entry_firstname; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="apelido" value="" class="large-field" /><span class="field-info">&nbsp;(Ex: Casa, Trabalho, etc)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address_1" value="" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td><input type="text" name="numero" value="" class="large-field numeric" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address_2" value="" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="complemento" value="" class="large-field" /><span class="field-info">&nbsp;(Ex: Ap. 105)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="" class="large-field numeric" />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Payment_Address -->

	<!-- Inicio: Catalog/Controller/Checkout/Shipping_Address -->
	<file name="catalog/controller/checkout/shipping_address.php">
		<operation>
			<search position="before" index="1" offset="1"><![CDATA[$json['error']['address_1'] = $this->language->get('error_address_1');]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$numero = preg_replace('/([^0-9])/i','',$this->request->post['numero']);
					if ((utf8_strlen($numero) < 1) || (utf8_strlen($numero) > 6)) {
						$json['error']['numero'] = 'Atenção: O número deve ter entre 1 e 6 caracteres!';
					}
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Shipping_Address -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Shipping_Address -->
	<file name="catalog/view/theme/*/template/checkout/shipping_address.tpl">
		<operation>
			<search position="before" index="1"><![CDATA[<?php if ($addresses) { ?>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<script type="text/javascript">
				$(function(){
					// Mascaras e Formatos
					if($('input.numeric').length > 0) $('input.numeric').numeric();
					if($('input.alpha').length > 0) $('input.alpha').alpha();
					if($('input.alphanumeric').length > 0) $('input.alphanumeric').alphanumeric();
				});
				</script>
				<?php }?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php
				$apelido     = ($address['apelido'] != '') ? '('. $address['apelido'] .') ' : '';
				$bairro      = ($address['address_2'] != '') ? ', ' . $address['address_2'] : '';
				$complemento = ($address['complemento'] != '') ? ', ' . $address['complemento'] : '';
				?>
				<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $apelido . $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['numero'] . $bairro . $complemento; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php }else{ ?>
				<option value="<?php echo $address['address_id']; ?>" selected="selected"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php } ?>
			]]></add>
		</operation>		
		<operation>
			<search position="replace" index="1"><![CDATA[<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<?php
				$apelido     = ($address['apelido'] != '') ? '('. $address['apelido'] .') ' : '';
				$bairro      = ($address['address_2'] != '') ? ', ' . $address['address_2'] : '';
				$complemento = ($address['complemento'] != '') ? ', ' . $address['complemento'] : '';
				?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $apelido . $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['numero'] . $bairro . $complemento; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php }else{ ?>
				<option value="<?php echo $address['address_id']; ?>"><?php echo $address['firstname']; ?> <?php echo $address['lastname']; ?>, <?php echo $address['address_1']; ?>, <?php echo $address['city']; ?>, <?php echo $address['zone']; ?>, <?php echo $address['country']; ?></option>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1" offset="1"><![CDATA[<td><span class="required">*</span> <?php echo $entry_firstname; ?></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Local:</td>
				  <td><input type="text" name="apelido" value="" class="large-field" /><span class="field-info">&nbsp;(Ex: Casa, Trabalho, etc)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address_1" value="" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td><span class="required">*</span> Número:</td>
				  <td><input type="text" name="numero" value="" class="large-field numeric" /></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[<td><input type="text" name="address_2" value="" class="large-field" /></td>]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				<tr>
				  <td>Complemento:</td>
				  <td><input type="text" name="complemento" value="" class="large-field" /><span class="field-info">&nbsp;(Ex: Ap. 105)</span></td>
				</tr>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field" />]]></search>
			<add><![CDATA[
				<input type="text" name="postcode" value="<?php echo $postcode; ?>" class="large-field numeric" />
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Shipping_Address -->

	<!-- Inicio: Catalog/View/Theme/*/Template/Checkout/Checkout -->
	<file name="catalog/view/theme/*/template/checkout/checkout.tpl">
		<operation>
			<search position="after" index="1,2" offset="1"><![CDATA[$('#payment-address input[name=\'firstname\'] + br').after('<span class="error">' + json['error']['firstname'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['data_nascimento']) {
					$('#payment-address input[name=\'data_nascimento\'] + br').after('<span class="error">' + json['error']['data_nascimento'] + '</span>');
				}

				if (json['error']['cpf']) {
					$('#payment-address input[name=\'cpf\'] + br').after('<span class="error">' + json['error']['cpf'] + '</span>');
				}

				if (json['error']['cnpj']) {
					$('#payment-address input[name=\'cnpj\'] + br').after('<span class="error">' + json['error']['cnpj'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1,2" offset="1"><![CDATA[$('#payment-address input[name=\'address_1\'] + br').after('<span class="error">' + json['error']['address_1'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['numero']) {
					$('#payment-address input[name=\'numero\'] + br').after('<span class="error">' + json['error']['numero'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="1"><![CDATA[$('#payment-address input[name=\'address_1\']').after('<span class="error">' + json['error']['address_1'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['numero']) {
					$('#payment-address input[name=\'numero\']').after('<span class="error">' + json['error']['numero'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1,2" offset="1"><![CDATA[$('#shipping-address input[name=\'address_1\']').after('<span class="error">' + json['error']['address_1'] + '</span>');]]></search>
			<add><![CDATA[
				<?php if ($this->config->get('fields_register_brazil_status')){ ?>
				if (json['error']['numero']) {
					$('#shipping-address input[name=\'numero\']').after('<span class="error">' + json['error']['numero'] + '</span>');
				}
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1"><![CDATA[data: $('#payment-address input[type=\'text\'], #payment-address input[type=\'checkbox\']:checked, #payment-address select'),]]></search>
			<add><![CDATA[
				data: $('#payment-address input[type=\'text\'], input[type=\'radio\']:checked, #payment-address input[type=\'checkbox\']:checked, #payment-address select'),
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/View/Theme/*/Template/Checkout/Checkout -->

	<!-- Inicio: Catalog/Model/Checkout/Order -->
	<file name="catalog/model/checkout/order.php">
		<operation>
			<search position="replace" index="1"><![CDATA[$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($data['invoice_prefix']) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($data['store_name']) . "', store_url = '" . $this->db->escape($data['store_url']) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($data['payment_country']) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($data['payment_zone']) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($data['payment_address_format']) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($data['shipping_country']) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($data['shipping_zone']) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($data['shipping_address_format']) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', total = '" . (float)$data['total'] . "', affiliate_id = '" . (int)$data['affiliate_id'] . "', commission = '" . (float)$data['commission'] . "', language_id = '" . (int)$data['language_id'] . "', currency_id = '" . (int)$data['currency_id'] . "', currency_code = '" . $this->db->escape($data['currency_code']) . "', currency_value = '" . (float)$data['currency_value'] . "', ip = '" . $this->db->escape($data['ip']) . "', forwarded_ip = '" .  $this->db->escape($data['forwarded_ip']) . "', user_agent = '" . $this->db->escape($data['user_agent']) . "', accept_language = '" . $this->db->escape($data['accept_language']) . "', date_added = NOW(), date_modified = NOW()");]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($data['invoice_prefix']) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($data['store_name']) . "', store_url = '" . $this->db->escape($data['store_url']) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', cpf = '" . $this->db->escape($data['cpf']) . "', cnpj = '" . $this->db->escape($data['cnpj']) . "', rg = '" . $this->db->escape($data['rg']) . "', razao_social = '" . $this->db->escape($data['razao_social']) . "', inscricao_estadual = '" . $this->db->escape($data['inscricao_estadual']) . "', data_nascimento = '" . $this->db->escape($data['data_nascimento']) . "', sexo = '" . $this->db->escape($data['sexo']) . "', payment_apelido = '" . $this->db->escape($data['payment_apelido']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_numero = '" . $this->db->escape($data['payment_numero']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_complemento = '" . $this->db->escape($data['payment_complemento']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($data['payment_country']) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($data['payment_zone']) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($data['payment_address_format']) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_apelido = '" . $this->db->escape($data['shipping_apelido']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_numero = '" . $this->db->escape($data['shipping_numero']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_complemento = '" . $this->db->escape($data['shipping_complemento']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($data['shipping_country']) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($data['shipping_zone']) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($data['shipping_address_format']) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', total = '" . (float)$data['total'] . "', affiliate_id = '" . (int)$data['affiliate_id'] . "', commission = '" . (float)$data['commission'] . "', language_id = '" . (int)$data['language_id'] . "', currency_id = '" . (int)$data['currency_id'] . "', currency_code = '" . $this->db->escape($data['currency_code']) . "', currency_value = '" . (float)$data['currency_value'] . "', ip = '" . $this->db->escape($data['ip']) . "', forwarded_ip = '" .  $this->db->escape($data['forwarded_ip']) . "', user_agent = '" . $this->db->escape($data['user_agent']) . "', accept_language = '" . $this->db->escape($data['accept_language']) . "', date_added = NOW(), date_modified = NOW()");
				}else{				
					$this->db->query("INSERT INTO `" . DB_PREFIX . "order` SET invoice_prefix = '" . $this->db->escape($data['invoice_prefix']) . "', store_id = '" . (int)$data['store_id'] . "', store_name = '" . $this->db->escape($data['store_name']) . "', store_url = '" . $this->db->escape($data['store_url']) . "', customer_id = '" . (int)$data['customer_id'] . "', customer_group_id = '" . (int)$data['customer_group_id'] . "', firstname = '" . $this->db->escape($data['firstname']) . "', lastname = '" . $this->db->escape($data['lastname']) . "', email = '" . $this->db->escape($data['email']) . "', telephone = '" . $this->db->escape($data['telephone']) . "', fax = '" . $this->db->escape($data['fax']) . "', payment_firstname = '" . $this->db->escape($data['payment_firstname']) . "', payment_lastname = '" . $this->db->escape($data['payment_lastname']) . "', payment_company = '" . $this->db->escape($data['payment_company']) . "', payment_company_id = '" . $this->db->escape($data['payment_company_id']) . "', payment_tax_id = '" . $this->db->escape($data['payment_tax_id']) . "', payment_address_1 = '" . $this->db->escape($data['payment_address_1']) . "', payment_address_2 = '" . $this->db->escape($data['payment_address_2']) . "', payment_city = '" . $this->db->escape($data['payment_city']) . "', payment_postcode = '" . $this->db->escape($data['payment_postcode']) . "', payment_country = '" . $this->db->escape($data['payment_country']) . "', payment_country_id = '" . (int)$data['payment_country_id'] . "', payment_zone = '" . $this->db->escape($data['payment_zone']) . "', payment_zone_id = '" . (int)$data['payment_zone_id'] . "', payment_address_format = '" . $this->db->escape($data['payment_address_format']) . "', payment_method = '" . $this->db->escape($data['payment_method']) . "', payment_code = '" . $this->db->escape($data['payment_code']) . "', shipping_firstname = '" . $this->db->escape($data['shipping_firstname']) . "', shipping_lastname = '" . $this->db->escape($data['shipping_lastname']) . "', shipping_company = '" . $this->db->escape($data['shipping_company']) . "', shipping_address_1 = '" . $this->db->escape($data['shipping_address_1']) . "', shipping_address_2 = '" . $this->db->escape($data['shipping_address_2']) . "', shipping_city = '" . $this->db->escape($data['shipping_city']) . "', shipping_postcode = '" . $this->db->escape($data['shipping_postcode']) . "', shipping_country = '" . $this->db->escape($data['shipping_country']) . "', shipping_country_id = '" . (int)$data['shipping_country_id'] . "', shipping_zone = '" . $this->db->escape($data['shipping_zone']) . "', shipping_zone_id = '" . (int)$data['shipping_zone_id'] . "', shipping_address_format = '" . $this->db->escape($data['shipping_address_format']) . "', shipping_method = '" . $this->db->escape($data['shipping_method']) . "', shipping_code = '" . $this->db->escape($data['shipping_code']) . "', comment = '" . $this->db->escape($data['comment']) . "', total = '" . (float)$data['total'] . "', affiliate_id = '" . (int)$data['affiliate_id'] . "', commission = '" . (float)$data['commission'] . "', language_id = '" . (int)$data['language_id'] . "', currency_id = '" . (int)$data['currency_id'] . "', currency_code = '" . $this->db->escape($data['currency_code']) . "', currency_value = '" . (float)$data['currency_value'] . "', ip = '" . $this->db->escape($data['ip']) . "', forwarded_ip = '" .  $this->db->escape($data['forwarded_ip']) . "', user_agent = '" . $this->db->escape($data['user_agent']) . "', accept_language = '" . $this->db->escape($data['accept_language']) . "', date_added = NOW(), date_modified = NOW()");
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1" offset="2"><![CDATA[$language_directory = '';]]></search>
			<add><![CDATA[
				$dataparts = explode('-', $order_query->row['data_nascimento']);
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA['fax'                     => $order_query->row['fax'],]]></search>
			<add><![CDATA[
				'data_nascimento'    => ($this->config->get('fields_register_brazil_status')) ? $dataparts[1].'/'.$dataparts[0].'/'.$dataparts[2] : '',
				'sexo'               => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['sexo'] : '',
				'cpf'                => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['cpf'] : '',
				'rg'                 => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['rg'] : '',
				'cnpj'               => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['cnpj'] : '',
				'razao_social'       => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['razao_social'] : '',
				'inscricao_estadual' => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['inscricao_estadual'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['shipping_firstname'      => $order_query->row['shipping_firstname'],]]></search>
			<add><![CDATA[
				'shipping_apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_apelido'] : '',
				'shipping_numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_numero'] : '',
				'shipping_complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['payment_firstname'       => $order_query->row['payment_firstname'],]]></search>
			<add><![CDATA[
				'payment_apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_apelido'] : '',
				'payment_numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_numero'] : '',
				'payment_complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_query->row['payment_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="replace" index="1,2"><![CDATA[$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';]]></search>
			<add><![CDATA[
				if ($this->config->get('fields_register_brazil_status')){
					$format = '{apelido}' . "\n" . '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}, {numero}, {complemento}' . "\n" . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}else{
					$format = '{firstname} {lastname}' . "\n" . '{company}' . "\n" . '{address_1}' . "\n" . '{address_2}' . "\n" . '{city} {postcode}' . "\n" . '{zone}' . "\n" . '{country}';
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1,2"><![CDATA['{firstname}',]]></search>
			<add><![CDATA[
				'{apelido}',
				'{numero}',
				'{complemento}',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['shipping_firstname'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['shipping_complemento'] : '',
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA['firstname' => $order_info['payment_firstname'],]]></search>
			<add><![CDATA[
				'apelido'     => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_apelido'] : '',
				'numero'      => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_numero'] : '',
				'complemento' => ($this->config->get('fields_register_brazil_status')) ? $order_info['payment_complemento'] : '',
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Model/Checkout/Order -->

	<!-- Inicio: Catalog/Controller/Checkout/Confirm -->
	<file name="catalog/controller/checkout/confirm.php">
		<operation>
			<search position="after" index="1"><![CDATA[$data['fax'] = $this->customer->getFax();]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$data['data_nascimento']    = $this->customer->getDataNascimento();
					$data['sexo']               = $this->customer->getSexo();
					$data['cpf']                = $this->customer->getCpf();
					$data['rg']                 = $this->customer->getRg();
					$data['cnpj']               = $this->customer->getCnpj();
					$data['razao_social']       = $this->customer->getRazaoSocial();
					$data['inscricao_estadual'] = $this->customer->getInscricaoEstadual();
				}
			]]></add>
		</operation>
		<operation>
			<search position="after" index="1"><![CDATA[$data['fax'] = $this->session->data['guest']['fax'];]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$dataparts = explode('/', $this->session->data['guest']['data_nascimento']);
					if (sizeof($dataparts) == '3'){
						$data['data_nascimento'] = $dataparts[2]."-".$dataparts[1]."-".$dataparts[0];
					}else{
						$data['data_nascimento'] = '0000-00-00';
					}
					
					$data['firstname']          = ucwords(strtr(strtolower($this->session->data['guest']['firstname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['lastname']           = ucwords(strtr(strtolower($this->session->data['guest']['lastname']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ"));
					$data['email']              = strtr(strtolower($this->session->data['guest']['email']),"ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÜÚÞß","àáâãäåæçèéêëìíîïðñòóôõö÷øùüúþÿ");
					$data['telephone']          = preg_replace('/([^0-9])/i','',$this->session->data['guest']['telephone']);
					$data['fax']                = preg_replace('/([^0-9])/i','',$this->session->data['guest']['fax']);
					$data['sexo']               = preg_replace('/([^a-z])/i','',$this->session->data['guest']['sexo']);
					$data['cpf']                = preg_replace('/([^0-9])/i','',$this->session->data['guest']['cpf']);
					$data['rg']                 = preg_replace('/([^0-9])/i','',$this->session->data['guest']['rg']);
					$data['cnpj']               = preg_replace('/([^0-9])/i','',$this->session->data['guest']['cnpj']);
					$data['razao_social']       = preg_replace('/([^a-z0-9])/i','',$this->session->data['guest']['razao_social']);
					$data['inscricao_estadual'] = preg_replace('/([^a-z0-9])/i','',$this->session->data['guest']['inscricao_estadual']);
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[$data['payment_firstname'] = $payment_address['firstname'];]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$data['payment_apelido']     = $payment_address['apelido'];
					$data['payment_numero']      = $payment_address['numero'];
					$data['payment_complemento'] = $payment_address['complemento'];
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[$data['shipping_firstname'] = $shipping_address['firstname'];]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$data['shipping_apelido']     = $shipping_address['apelido'];
					$data['shipping_numero']      = $shipping_address['numero'];
					$data['shipping_complemento'] = $shipping_address['complemento'];
				}
			]]></add>
		</operation>
		<operation>
			<search position="before" index="1"><![CDATA[$data['shipping_firstname'] = '';]]></search>
			<add><![CDATA[
				if($this->config->get('fields_register_brazil_status')){
					$data['shipping_apelido']     = '';
					$data['shipping_numero']      = '';
					$data['shipping_complemento'] = '';
				}
			]]></add>
		</operation>
	</file>
	<!-- Fim: Catalog/Controller/Checkout/Confirm -->
</modification>