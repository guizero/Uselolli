<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>Apply Button</id>
	<version>1.0</version>
	<vqmver>2.1</vqmver>
	<author>Vladislav Nazarov - Sparta</author>
	<file name="/admin/controller/common/header.php">
		<operation>
			<search position="after"><![CDATA[
				$this->data['text_zone'] = $this->language->get('text_zone');]]></search>
			<add><![CDATA[
				$this->load->language('module/apply_button');
				$this->data['text_apply'] = $this->language->get('text_apply');]]></add>
		</operation>
	</file>	
	<file name="/admin/view/template/common/header.tpl">
		<operation>
			<search position="before"><![CDATA[
				</head>]]></search>
			<add><![CDATA[
				<script type="text/javascript"><!--
                //-----------------------------------------
                // Apply Button
                //-----------------------------------------
                $(document).ready(function(){
                   $("a.button").each(function(){
                      var onclick = $(this).attr('onclick');
                      if(typeof onclick != 'undefined' && onclick.indexOf('#form') != -1 && onclick.indexOf('.submit()') != -1){
                         var apply = '<a class="button" onclick="apply_form()"><?php echo $text_apply; ?></a>';
                         $(this).after(apply);
                      }
                   });
                });

                function apply_form(){
                   $.ajax({
                      type: 'POST',
                      url: $('#form').attr('action'),
                      data: $('#form').serialize(),
                      dataType: 'text',
                      success: function(data){
                            if($(data).find('.error').length > 0){
                               $("#form").submit();
                            }else{
                               $('.success,.warning,.attention,.required').remove();
                               $(data).find('.success,.warning,.attention,.required').clone().appendTo('div.breadcrumb').css('margin-top','10px');
                               setTimeout(function(){$('.success,.warning,.attention,.required').remove()},5000);
                            }
                         }
                   });
                }
                //--></script>]]></add>
		</operation>
	</file>	
</modification>